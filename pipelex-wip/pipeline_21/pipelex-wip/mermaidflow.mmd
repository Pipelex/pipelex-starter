flowchart LR

    %% Pipe and stuff nodes within controller subgraphs
    subgraph sg_n_314cd9d12d["screen_candidates"]
        subgraph sg_n_25cb2fdddc["process_all_cvs"]
            subgraph sg_n_24453953c2["process_single_cv"]
                subgraph sg_n_b85a17024b["route_candidate"]
                    subgraph sg_n_80d6c70cb1["handle_fit"]
                        n_2378cf4964["compose_outcome_fit"]
                        s_39e8fc2dbb(["candidate_outcome<br/>CandidateOutcome"]):::stuff
                        n_e60ee47ed8["generate_interview_questions"]
                        s_62aee5b891(["interview_questions<br/>InterviewQuestion"]):::stuff
                    end
                    subgraph sg_n_45e331d7de["handle_no_fit"]
                        n_aca8cd803b["compose_outcome_no_fit"]
                        s_ef8f058b09(["candidate_outcome<br/>CandidateOutcome"]):::stuff
                        n_ee79b8cc16["draft_rejection_email"]
                        s_ca0f982578(["rejection_email<br/>Text"]):::stuff
                    end
                end
                n_9b1990a1e8["extract_cv"]
                s_8fdbdd962b(["cv<br/>Document"]):::stuff
                s_2fa6c62827(["pages<br/>Page"]):::stuff
                n_c811094f4b["score_cv"]
                s_43e99bed90(["evaluation<br/>Evaluation"]):::stuff
            end
            subgraph sg_n_ac83307a01["process_single_cv"]
                subgraph sg_n_f814f1b3e3["route_candidate"]
                    subgraph sg_n_19f86255cd["handle_fit"]
                        n_4c4ba1319c["compose_outcome_fit"]
                        s_1c4d3e4fe7(["candidate_outcome<br/>CandidateOutcome"]):::stuff
                        n_e2f10ba1c6["generate_interview_questions"]
                        s_844072e1bc(["interview_questions<br/>InterviewQuestion"]):::stuff
                    end
                    subgraph sg_n_09242ae66b["handle_no_fit"]
                        n_6331458737["compose_outcome_no_fit"]
                        s_77f0d33b2d(["candidate_outcome<br/>CandidateOutcome"]):::stuff
                        n_84dc819b2b["draft_rejection_email"]
                        s_badc7347ce(["rejection_email<br/>Text"]):::stuff
                    end
                end
                n_70f743ec94["extract_cv"]
                s_5ad08770d6(["cv<br/>Document"]):::stuff
                s_26f8e64a31(["pages<br/>Page"]):::stuff
                n_be86e0c910["score_cv"]
                s_4fe4a9cf8f(["evaluation<br/>Evaluation"]):::stuff
            end
            subgraph sg_n_155b4bfe9f["process_single_cv"]
                subgraph sg_n_18d6e75de4["route_candidate"]
                    subgraph sg_n_b9ab2ab791["handle_fit"]
                        n_990d62743f["compose_outcome_fit"]
                        s_b4640c0418(["candidate_outcome<br/>CandidateOutcome"]):::stuff
                        n_74ea5c87b8["generate_interview_questions"]
                        s_dc98ade944(["interview_questions<br/>InterviewQuestion"]):::stuff
                    end
                    subgraph sg_n_f35d1f0f7d["handle_no_fit"]
                        n_7cb96d726f["compose_outcome_no_fit"]
                        s_245ac25fbb(["candidate_outcome<br/>CandidateOutcome"]):::stuff
                        n_d00fe93e26["draft_rejection_email"]
                        s_d7f7274329(["rejection_email<br/>Text"]):::stuff
                    end
                end
                n_2a313bdb47["extract_cv"]
                s_6ac52cf647(["cv<br/>Document"]):::stuff
                s_9d9db8129c(["pages<br/>Page"]):::stuff
                n_1410cfdc39["score_cv"]
                s_2b9d640682(["evaluation<br/>Evaluation"]):::stuff
            end
        end
        n_19c6828094["build_scorecard"]
        s_3014f7d7f3(["scorecard<br/>Scorecard"]):::stuff
    end

    %% Pipeline input stuff nodes (no producer)
    s_c3c022feec(["job_offer<br/>Text"]):::stuff

    %% Data flow edges: producer -> stuff -> consumer
    n_74ea5c87b8 --> s_dc98ade944
    n_aca8cd803b --> s_ef8f058b09
    n_be86e0c910 --> s_4fe4a9cf8f
    n_c811094f4b --> s_43e99bed90
    n_990d62743f --> s_b4640c0418
    n_e60ee47ed8 --> s_62aee5b891
    n_2378cf4964 --> s_39e8fc2dbb
    n_70f743ec94 --> s_26f8e64a31
    n_19c6828094 --> s_3014f7d7f3
    n_2a313bdb47 --> s_9d9db8129c
    n_e2f10ba1c6 --> s_844072e1bc
    n_4c4ba1319c --> s_1c4d3e4fe7
    n_1410cfdc39 --> s_2b9d640682
    n_84dc819b2b --> s_badc7347ce
    n_ee79b8cc16 --> s_ca0f982578
    n_d00fe93e26 --> s_d7f7274329
    n_9b1990a1e8 --> s_2fa6c62827
    n_7cb96d726f --> s_245ac25fbb
    n_6331458737 --> s_77f0d33b2d
    s_c3c022feec --> n_19c6828094
    s_dc98ade944 --> n_990d62743f
    s_4fe4a9cf8f --> n_84dc819b2b
    s_4fe4a9cf8f --> n_6331458737
    s_4fe4a9cf8f --> n_e2f10ba1c6
    s_4fe4a9cf8f --> n_4c4ba1319c
    s_43e99bed90 --> n_ee79b8cc16
    s_43e99bed90 --> n_aca8cd803b
    s_43e99bed90 --> n_e60ee47ed8
    s_43e99bed90 --> n_2378cf4964
    s_62aee5b891 --> n_2378cf4964
    s_26f8e64a31 --> n_be86e0c910
    s_26f8e64a31 --> n_e2f10ba1c6
    s_3014f7d7f3 --> n_74ea5c87b8
    s_3014f7d7f3 --> n_c811094f4b
    s_3014f7d7f3 --> n_ee79b8cc16
    s_3014f7d7f3 --> n_e60ee47ed8
    s_3014f7d7f3 --> n_be86e0c910
    s_3014f7d7f3 --> n_84dc819b2b
    s_3014f7d7f3 --> n_e2f10ba1c6
    s_3014f7d7f3 --> n_1410cfdc39
    s_3014f7d7f3 --> n_d00fe93e26
    s_9d9db8129c --> n_74ea5c87b8
    s_9d9db8129c --> n_1410cfdc39
    s_844072e1bc --> n_4c4ba1319c
    s_2b9d640682 --> n_74ea5c87b8
    s_2b9d640682 --> n_990d62743f
    s_2b9d640682 --> n_d00fe93e26
    s_2b9d640682 --> n_7cb96d726f
    s_badc7347ce --> n_6331458737
    s_ca0f982578 --> n_aca8cd803b
    s_6ac52cf647 --> n_2a313bdb47
    s_8fdbdd962b --> n_9b1990a1e8
    s_5ad08770d6 --> n_70f743ec94
    s_d7f7274329 --> n_7cb96d726f
    s_2fa6c62827 --> n_c811094f4b
    s_2fa6c62827 --> n_e60ee47ed8

    %% Batch edges: list-item relationships
    n_25cb2fdddc -."[0]".-> n_155b4bfe9f
    n_25cb2fdddc -."[0]".-> n_2a313bdb47
    n_25cb2fdddc -."[1]".-> n_24453953c2
    n_25cb2fdddc -."[1]".-> n_9b1990a1e8
    n_25cb2fdddc -."[2]".-> n_ac83307a01
    n_25cb2fdddc -."[2]".-> n_70f743ec94
    n_155b4bfe9f -."[0]".-> n_25cb2fdddc
    n_24453953c2 -."[1]".-> n_25cb2fdddc
    n_ac83307a01 -."[2]".-> n_25cb2fdddc

    %% Style definitions
    classDef failed fill:#ffcccc,stroke:#cc0000
    classDef stuff fill:#fff3e6,stroke:#cc6600,stroke-width:2px
    classDef controller fill:#e6f3ff,stroke:#0066cc

    %% Subgraph depth-based coloring
    style sg_n_09242ae66b fill:#f0e6ff
    style sg_n_155b4bfe9f fill:#fffde6
    style sg_n_18d6e75de4 fill:#ffe6f0
    style sg_n_19f86255cd fill:#f0e6ff
    style sg_n_24453953c2 fill:#fffde6
    style sg_n_25cb2fdddc fill:#e6ffe6
    style sg_n_314cd9d12d fill:#e6f3ff
    style sg_n_45e331d7de fill:#f0e6ff
    style sg_n_80d6c70cb1 fill:#f0e6ff
    style sg_n_ac83307a01 fill:#fffde6
    style sg_n_b85a17024b fill:#ffe6f0
    style sg_n_b9ab2ab791 fill:#f0e6ff
    style sg_n_f35d1f0f7d fill:#f0e6ff
    style sg_n_f814f1b3e3 fill:#ffe6f0