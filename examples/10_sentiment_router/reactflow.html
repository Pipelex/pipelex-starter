<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pipeline: Classify And Respond</title>
<!-- React and ReactDOM from CDN -->
<script nonce="PIPELEX_CSP_NONCE" crossorigin="anonymous" src="https://unpkg.com/react@18/umd/react.production.min.js" integrity="sha384-DGyLxAyjq0f9SPpVevD6IgztCFlnMF6oW/XQGmfe+IsZ8TqEiDrcHkMLKI6fiB/Z"></script>
<script nonce="PIPELEX_CSP_NONCE" crossorigin="anonymous" src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" integrity="sha384-gTGxhz21lVGYNMcdJOyq01Edg0jhn/c22nsx0kyqP0TxaV5WVdsSH1fSDUf5YJj1"></script>
<!-- ReactFlow from CDN (v11 - using reactflow package for UMD support) -->
<script nonce="PIPELEX_CSP_NONCE" src="https://unpkg.com/reactflow@11.11.4/dist/umd/index.js" integrity="sha384-lA1w00Vex5qXDv4/xYJO/e8SCjfdlNghbTP+s+2zl37rCEAC7trsSRpYrv/JQy5y" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://unpkg.com/reactflow@11.11.4/dist/style.css">
<!-- Dagre for layout -->
<script nonce="PIPELEX_CSP_NONCE" src="https://unpkg.com/dagre@0.8.5/dist/dagre.min.js" integrity="sha384-2IH3T69EIKYC4c+RXZifZRvaH5SRUdacJW7j6HtE5rQbvLhKKdawxq6vpIzJ7j9M" crossorigin="anonymous"></script>
<!-- DOMPurify for HTML sanitization (XSS prevention) -->
<script nonce="PIPELEX_CSP_NONCE" src="https://cdn.jsdelivr.net/npm/dompurify@3.2.4/dist/purify.min.js" integrity="sha384-eEu5CTj3qGvu9PdJuS+YlkNi7d2XxQROAFYOr59zgObtlcux1ae1Il3u7jvdCSWu" crossorigin="anonymous"></script>
<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style nonce="PIPELEX_CSP_NONCE">
/* Dark theme (default) */
:root, [data-theme="dark"] {
    --color-bg: #1e1e1e;
    --color-surface: #1e293b;
    --color-surface-hover: #334155;
    --color-border: #334155;
    --color-text: #f1f5f9;
    --color-text-muted: #94a3b8;
    --color-text-dim: #64748b;
    --color-accent: #3b82f6;
    --color-accent-hover: #60a5fa;
    --color-success: #10b981;
    --color-success-bg: rgba(16, 185, 129, 0.15);
    --color-error: #ef4444;
    --color-error-bg: rgba(239, 68, 68, 0.15);
    --color-warning: #f59e0b;
    --color-stuff: #f59e0b;
    --color-stuff-bg: rgba(245, 158, 11, 0.15);
    --color-stuff-border: #d97706;
    --color-stuff-text: #fef3c7;
    --color-stuff-text-dim: #fcd34d;
    --color-pipe: #3b82f6;
    --color-pipe-bg: rgba(59, 130, 246, 0.1);
    --color-pipe-text: #dbeafe;
    --color-pipe-failed: #ef4444;
    --color-pipe-failed-bg: rgba(239, 68, 68, 0.15);
    --color-edge: #3b82f6;
    --color-batch-item: #a855f7;
    --color-batch-aggregate: #22c55e;
    --color-parallel-combine: #c084fc;
    --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    --font-mono: 'JetBrains Mono', 'Monaco', 'Menlo', monospace;
    --radius-sm: 4px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --radius-pill: 999px;
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
    --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.5);
}
/* Light theme */
[data-theme="light"] {
    --color-bg: #f8fafc;
    --color-surface: #ffffff;
    --color-surface-hover: #f1f5f9;
    --color-border: #e2e8f0;
    --color-text: #1e293b;
    --color-text-muted: #64748b;
    --color-text-dim: #94a3b8;
    --color-accent: #3b82f6;
    --color-accent-hover: #2563eb;
    --color-success: #10b981;
    --color-success-bg: rgba(16, 185, 129, 0.1);
    --color-error: #ef4444;
    --color-error-bg: rgba(239, 68, 68, 0.1);
    --color-warning: #f59e0b;
    --color-stuff: #f59e0b;
    --color-stuff-bg: rgba(245, 158, 11, 0.1);
    --color-stuff-border: #d97706;
    --color-stuff-text: #78350f;
    --color-stuff-text-dim: #92400e;
    --color-pipe: #3b82f6;
    --color-pipe-bg: rgba(59, 130, 246, 0.08);
    --color-pipe-text: #1e3a8a;
    --color-pipe-failed: #ef4444;
    --color-pipe-failed-bg: rgba(239, 68, 68, 0.1);
    --color-edge: #3b82f6;
    --color-batch-item: #9333ea;
    --color-batch-aggregate: #16a34a;
    --color-parallel-combine: #a855f7;
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.15);
}
/* System theme - follows OS preference */
@media (prefers-color-scheme: light) {
    [data-theme="system"] {
        --color-bg: #f8fafc;
        --color-surface: #ffffff;
        --color-surface-hover: #f1f5f9;
        --color-border: #e2e8f0;
        --color-text: #1e293b;
        --color-text-muted: #64748b;
        --color-text-dim: #94a3b8;
        --color-accent: #3b82f6;
        --color-accent-hover: #2563eb;
        --color-success: #10b981;
        --color-success-bg: rgba(16, 185, 129, 0.1);
        --color-error: #ef4444;
        --color-error-bg: rgba(239, 68, 68, 0.1);
        --color-warning: #f59e0b;
        --color-stuff: #f59e0b;
        --color-stuff-bg: rgba(245, 158, 11, 0.1);
        --color-stuff-border: #d97706;
        --color-stuff-text: #78350f;
        --color-stuff-text-dim: #92400e;
        --color-pipe: #3b82f6;
        --color-pipe-bg: rgba(59, 130, 246, 0.08);
        --color-pipe-text: #1e3a8a;
        --color-pipe-failed: #ef4444;
        --color-pipe-failed-bg: rgba(239, 68, 68, 0.1);
        --color-edge: #3b82f6;
        --color-batch-item: #9333ea;
        --color-batch-aggregate: #16a34a;
        --color-parallel-combine: #a855f7;
        --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.15);
    }
}

/* === PALETTES === */
/* Yellow-Blue palette is the default (uses theme colors) */

/* Dracula palette - vibrant dark theme with high contrast */
[data-palette="dracula"] {
    /* Pipes / Execution Units - Salmon red (matches MTHDS syntax highlighting) */
    --color-pipe: #ff6b6b;
    --color-pipe-bg: rgba(224, 108, 117, 0.18);
    --color-pipe-text: #ffffff;

    /* Stuff / Concepts - Teal border with Pale Green variable names */
    --color-stuff: #4ECDC4;
    --color-stuff-bg: rgba(78, 205, 196, 0.12);
    --color-stuff-border: #9ddcfd;
    --color-stuff-text: #98FB98;          /* Pale Green - flashy for variable names */
    --color-stuff-text-dim: #9ddcfd;      /* Light Cyan - for concept names */

    /* Edges / Data Flow - Super light yellow, almost white */
    --color-edge: #FFFACD;
    --color-batch-item: #bd93f9;
    --color-batch-aggregate: #50fa7b;
    --color-parallel-combine: #d6a4ff;

    /* Status colors */
    --color-success: #50FA7B;             /* Bright Green */
    --color-success-bg: rgba(80, 250, 123, 0.15);
    --color-error: #FF5555;               /* Dracula Red */
    --color-error-bg: rgba(255, 85, 85, 0.15);

    /* Supporting colors */
    --color-accent: #8BE9FD;              /* Light Cyan - control flow */
    --color-warning: #FFB86C;             /* Orange - structural elements */
    --color-template: #FF79C6;            /* Magenta/Pink - template markers */
    --color-metadata: #F1FA8C;            /* Pale Yellow - attributes */
    --color-comment: #6272A4;             /* Slate Blue/Gray - comments */
}

/* Light theme adjustments for Dracula palette */
[data-theme="light"][data-palette="dracula"] {
    --color-pipe-text: #8B0000;
    --color-stuff-text: #006400;          /* Dark green for light mode */
    --color-stuff-text-dim: #006666;
    --color-edge: #B8860B;                /* Darker yellow for light mode */
}

@media (prefers-color-scheme: light) {
    [data-theme="system"][data-palette="dracula"] {
        --color-pipe-text: #8B0000;
        --color-stuff-text: #006400;
        --color-stuff-text-dim: #006666;
        --color-edge: #B8860B;
    }
}

* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: var(--font-sans);
    height: 100vh;
    overflow: hidden;
    background: var(--color-bg);
    color: var(--color-text);
}
#app-container {
    display: flex;
    flex-direction: column;
    height: 100vh;
}
.header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 20px;
    background: var(--color-surface);
    border-bottom: 1px solid var(--color-border);
    z-index: 100;
}
.header-left {
    display: flex;
    align-items: center;
    gap: 16px;
}
.header-logo {
    height: 28px;
    width: auto;
}
.header-logo.dark-logo { display: block; }
.header-logo.light-logo { display: none; }
[data-theme="light"] .header-logo.dark-logo { display: none; }
[data-theme="light"] .header-logo.light-logo { display: block; }
@media (prefers-color-scheme: light) {
    [data-theme="system"] .header-logo.dark-logo { display: none; }
    [data-theme="system"] .header-logo.light-logo { display: block; }
}
.header-title {
    font-size: 14px;
    color: var(--color-text-muted);
    font-weight: 500;
}
.header-actions {
    display: flex;
    align-items: center;
    gap: 8px;
}
.header-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: var(--color-surface-hover);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.15s ease;
    font-size: 16px;
    line-height: 1;
}
.header-btn:hover {
    background: var(--color-accent);
    border-color: var(--color-accent);
}
.theme-icon { display: none; }
.theme-icon.active { display: inline; }
.direction-icon { display: none; color: var(--color-text); }
.direction-icon.active { display: inline-flex; align-items: center; justify-content: center; }
.stat-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: var(--color-text-muted);
}
.stat-value {
    font-weight: 600;
    color: var(--color-text);
}
.stat-icon {
    width: 16px;
    height: 16px;
    opacity: 0.7;
}
#root {
    flex: 1;
    width: 100%;
    overflow: hidden;
}
.react-flow-container {
    width: 100%;
    height: 100%;
    background: var(--color-bg);
}
.react-flow__node {
    font-family: var(--font-sans);
}
.react-flow__background {
    background: var(--color-bg) !important;
}
.react-flow__controls {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-md);
    bottom: 57px !important;
    left: 16px !important;
}
.react-flow__controls-button {
    background: var(--color-surface);
    border-bottom: 1px solid var(--color-border);
    fill: var(--color-text-muted);
}
.react-flow__controls-button:hover {
    background: var(--color-surface-hover);
}
.react-flow__edge-path {
    stroke-width: 2;
}
.react-flow__edge-text {
    font-size: 11px;
    fill: var(--color-text-muted);
}
.react-flow__edge-textbg {
    fill: var(--color-bg);
}
/* Selected node highlight */
.react-flow__node.selected {
    box-shadow: 0 0 0 3px var(--color-accent), var(--shadow-lg) !important;
    z-index: 1000 !important;
}

/* Inspector Sidebar */
.inspector-panel {
    position: fixed;
    top: 57px;
    right: 0;
    width: 40vw;
    min-width: 360px;
    max-width: 80vw;
    height: calc(100vh - 57px - 41px);
    background: var(--color-surface);
    border-left: 1px solid var(--color-border);
    box-shadow: -4px 0 20px rgba(0, 0, 0, 0.3);
    overflow: hidden;
    z-index: 1000;
    display: none;
    transition: none;
}
.inspector-panel.visible {
    display: flex;
    flex-direction: column;
}
.inspector-resize-handle {
    position: absolute;
    left: 0;
    top: 0;
    width: 6px;
    height: 100%;
    cursor: ew-resize;
    background: transparent;
    z-index: 10;
    transition: background 0.2s;
}
.inspector-resize-handle:hover,
.inspector-resize-handle.dragging {
    background: var(--color-accent);
}
.inspector-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    background: linear-gradient(135deg, var(--color-accent), var(--color-stuff));
    color: white;
}
.inspector-header.stuff {
    background: linear-gradient(135deg, var(--color-stuff), var(--color-stuff-border));
}
.inspector-header.pipe {
    background: linear-gradient(135deg, var(--color-pipe), var(--color-accent));
}
.inspector-title {
    font-size: 15px;
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.inspector-subtitle {
    font-size: 12px;
    opacity: 0.85;
    margin-top: 2px;
}
.inspector-close {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    background: rgba(255,255,255,0.2);
    border-radius: var(--radius-sm);
    font-size: 18px;
    line-height: 1;
    transition: background 0.15s;
}
.inspector-close:hover {
    background: rgba(255,255,255,0.3);
}
.inspector-content {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
}
/* Only apply flex behavior to the stuff data section, not all sections */
.inspector-content.stuff-inspector {
    display: flex;
    flex-direction: column;
}
.inspector-content.stuff-inspector > .inspector-section {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-height: 0;
}
#stuff-data-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 0;
}
#stuff-data-content > .inspector-pre,
#stuff-data-content.inspector-html-content {
    flex: 1;
    max-height: none;
    min-height: 0;
    overflow-y: auto;
}
.inspector-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 16px;
}
.inspector-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 10px;
    font-size: 12px;
    font-weight: 500;
    border-radius: 999px;
}
.inspector-badge.success {
    background: var(--color-success-bg);
    color: var(--color-success);
}
.inspector-badge.error {
    background: var(--color-error-bg);
    color: var(--color-error);
}
.inspector-badge.neutral {
    background: var(--color-surface-hover);
    color: var(--color-text-muted);
}
.inspector-badge.stuff {
    background: var(--color-stuff-bg);
    color: var(--color-stuff);
}
.inspector-section {
    margin-bottom: 16px;
}
.inspector-section:last-child {
    margin-bottom: 0;
}
.inspector-section-title {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--color-text-dim);
    margin-bottom: 8px;
}
.inspector-value {
    font-size: 14px;
    color: var(--color-text);
    word-break: break-word;
}
.inspector-value.pipe-code {
    font-family: var(--font-mono);
    color: var(--color-accent);
}
.inspector-pre {
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    padding: 12px;
    border-radius: var(--radius-md);
    font-family: var(--font-mono);
    font-size: 12px;
    line-height: 1.5;
    color: var(--color-text-muted);
    overflow-x: auto;
    max-height: 300px;
    overflow-y: auto;
    white-space: pre-wrap;
    word-break: break-word;
}
/* No-wrap variant for Rich-formatted ASCII tables (Pretty/Text tab) */
.inspector-pre.nowrap {
    white-space: pre;
    word-break: normal;
    line-height: 1;
    padding-right: 20px;
    -webkit-overflow-scrolling: touch;
}
.inspector-row {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid var(--color-border);
}
.inspector-row:last-child {
    border-bottom: none;
}
.inspector-row-label {
    color: var(--color-text-dim);
    font-size: 13px;
}
.inspector-row-value {
    color: var(--color-text);
    font-size: 13px;
    font-weight: 500;
}

/* Format toolbar for stuff data */
.format-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    gap: 8px;
}
.format-tabs {
    display: flex;
    gap: 4px;
}
.format-tab {
    padding: 6px 12px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    background: var(--color-surface-hover);
    color: var(--color-text-muted);
    border: none;
    transition: all 0.2s;
}
.format-tab:hover {
    background: var(--color-border);
    color: var(--color-text);
}
.format-tab.active {
    background: var(--color-accent);
    color: #fff;
}
.format-tab:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}
.format-actions {
    display: flex;
    gap: 4px;
}
.action-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-size: 14px;
    background: var(--color-surface-hover);
    color: var(--color-text-muted);
    border: none;
    transition: all 0.2s;
}
.action-btn:hover {
    background: var(--color-border);
    color: var(--color-text);
}
.action-btn.copied {
    background: var(--color-success-bg);
    color: var(--color-success);
}
.action-btn svg {
    width: 16px;
    height: 16px;
    fill: currentColor;
}
.inspector-html-content {
    background: var(--color-bg);
    color: var(--color-text-muted);
    padding: 12px;
    border-radius: var(--radius-md);
    font-family: var(--font-sans);
}
.inspector-html-content table {
    border-collapse: collapse;
    width: 100%;
}
.inspector-html-content th,
.inspector-html-content td {
    border: 1px solid var(--color-border);
    padding: 8px 12px;
    text-align: left;
}
.inspector-html-content th {
    background: var(--color-surface-hover);
    color: var(--color-text);
    font-weight: 600;
}
.inspector-html-content tr:hover {
    background: var(--color-surface-hover);
}
.inspector-pdf-content {
    flex: 1;
    min-height: 400px;
}
.fullscreen-content.inspector-pdf-content {
    height: 100%;
}
.inspector-image-content {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 300px;
}
.inspector-image-content img {
    max-width: 100%;
    max-height: 70vh;
    object-fit: contain;
}
.fullscreen-content.inspector-image-content {
    height: 100%;
}

/* Top hint capsule */
.top-hint {
    position: fixed;
    top: 70px;
    right: 16px;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-pill);
    padding: 8px 16px;
    font-size: 12px;
    color: var(--color-text-dim);
    z-index: 100;
    box-shadow: var(--shadow-md);
}

/* Footer */
.footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--color-surface);
    border-top: 1px solid var(--color-border);
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 100;
    font-size: 12px;
}
.footer-legend {
    display: flex;
    gap: 20px;
}
.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--color-text-muted);
}
.legend-dot {
    width: 12px;
    height: 12px;
    border-radius: 3px;
}
.legend-dot.pipe {
    background: var(--color-pipe);
}
.legend-dot.stuff {
    background: var(--color-stuff);
    border-radius: 6px;
}
.legend-dot.success {
    background: var(--color-success);
}
.legend-dot.error {
    background: var(--color-error);
}
.footer-stats {
    display: flex;
    gap: 16px;
}

/* Full-screen modal for stuff data */
.fullscreen-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--color-bg);
    z-index: 2000;
    display: none;
    flex-direction: column;
}
.fullscreen-modal.visible {
    display: flex;
}
.fullscreen-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 24px;
    background: linear-gradient(135deg, var(--color-stuff), var(--color-stuff-border));
    color: white;
    border-bottom: 1px solid var(--color-border);
}
.fullscreen-header-left {
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.fullscreen-title {
    font-size: 18px;
    font-weight: 600;
}
.fullscreen-subtitle {
    font-size: 13px;
    opacity: 0.9;
}
.fullscreen-header-actions {
    display: flex;
    gap: 8px;
}
.fullscreen-action-btn {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    background: rgba(255,255,255,0.2);
    border: none;
    border-radius: var(--radius-md);
    color: white;
    transition: background 0.15s;
}
.fullscreen-action-btn:hover {
    background: rgba(255,255,255,0.3);
}
.fullscreen-action-btn svg {
    width: 20px;
    height: 20px;
    fill: currentColor;
}
.fullscreen-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 24px;
    background: var(--color-surface);
    border-bottom: 1px solid var(--color-border);
}
.fullscreen-content {
    flex: 1;
    overflow: auto;
    padding: 24px;
    display: flex;
    flex-direction: column;
}
.fullscreen-content > .inspector-pre,
.fullscreen-content.inspector-html-content {
    flex: 1;
    max-height: none;
    min-height: 0;
    margin: 0;
}
    </style>
</head>
<body>
<div id="app-container">
    <header class="header">
        <div class="header-left">
            <img src="https://d2cinlfp2qnig1.cloudfront.net/logo/Pipelex-logo-wot-1119x352.png" alt="Pipelex" class="header-logo dark-logo">
            <img src="https://d2cinlfp2qnig1.cloudfront.net/logo/Pipelex-logo-bot-1119x352.png" alt="Pipelex" class="header-logo light-logo">
            <span class="header-title">Pipeline: Classify And Respond</span>
        </div>
        <div class="header-actions">
            <button id="direction-toggle" class="header-btn" title="Toggle layout direction (Left-to-Right / Top-Down)">
                <span class="direction-icon lr-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span>
                <span class="direction-icon tb-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><polyline points="19 12 12 19 5 12"/></svg></span>
            </button>
            <button id="theme-toggle" class="header-btn theme-toggle" title="Toggle theme (Dark/Light/System)">
            <span class="theme-icon dark-icon">üåô</span>
            <span class="theme-icon light-icon">‚òÄÔ∏è</span>
            <span class="theme-icon system-icon">üíª</span>
        </button>
        </div>
    </header>
    <div id="root"></div>
</div>

<div id="inspector" class="inspector-panel">
    <div class="inspector-resize-handle" id="inspector-resize-handle"></div>
    <div class="inspector-header" id="inspector-header">
        <div>
            <div id="inspector-title" class="inspector-title">Node Details</div>
            <div id="inspector-subtitle" class="inspector-subtitle"></div>
        </div>
        <span class="inspector-close" onclick="closeInspector()">&times;</span>
    </div>
    <div id="inspector-content" class="inspector-content"></div>
</div>

<div class="top-hint" id="top-hint">Click on nodes to view details</div>

<!-- Full-screen modal for stuff data -->
<div id="fullscreen-modal" class="fullscreen-modal">
    <div class="fullscreen-header">
        <div class="fullscreen-header-left">
            <div id="fullscreen-title" class="fullscreen-title">Data</div>
            <div id="fullscreen-subtitle" class="fullscreen-subtitle">Data Item</div>
        </div>
        <div class="fullscreen-header-actions">
            <button class="fullscreen-action-btn" onclick="minimizeFullscreen()" title="Back to sidebar">
                <svg viewBox="0 0 24 24"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>
            </button>
            <button class="fullscreen-action-btn fullscreen-close-btn" onclick="closeFullscreenAndInspector()" title="Close">
                <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
            </button>
        </div>
    </div>
    <div class="fullscreen-toolbar">
        <div class="format-tabs" id="fullscreen-format-tabs"></div>
        <div class="format-actions">
            <button class="action-btn" id="fullscreen-open-external-btn" onclick="openExternal()" title="Open in new window" style="display: none;">
                <svg viewBox="0 0 24 24"><path d="M19 19H5V5h7V3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg>
            </button>
            <button class="action-btn" id="fullscreen-copy-btn" onclick="copyStuffContent()" title="Copy">
                <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            </button>
            <button class="action-btn" id="fullscreen-download-btn" onclick="downloadStuffContent()" title="Download">
                <svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
            </button>
        </div>
    </div>
    <div id="fullscreen-content" class="fullscreen-content"></div>
</div>

<footer class="footer">
    <div class="footer-legend">
        <div class="legend-item"><div class="legend-dot pipe"></div>Pipe</div>
        <div class="legend-item"><div class="legend-dot stuff"></div>Data</div>
        <div class="legend-item"><div class="legend-dot success"></div>Success</div>
        <div class="legend-item"><div class="legend-dot error"></div>Failed</div>
    </div>
    <div class="footer-stats" id="footer-stats"></div>
</footer>

<!-- Embedded ViewSpec -->
<script type="application/json" id="pipelex-viewspec">{
  "schema_version": "1.0",
  "created_at": "2026-02-22T09:30:40.591698Z",
  "graph_id": "0075b36d-2197-4d1f-9221-3b92d138a791",
  "source": {
    "producer": "pipelex 0.18.0b3",
    "domain": "customer_feedback_response",
    "main_pipe": "classify_and_respond"
  },
  "engine": "reactflow",
  "options": {},
  "layout": {
    "engine": "dagre",
    "direction": "top_down",
    "nodesep": 50,
    "ranksep": 30,
    "align": null,
    "allow_manual_positions": true
  },
  "nodes": [
    {
      "id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_0",
      "label": "classify_and_respond",
      "kind": "controller",
      "status": "succeeded",
      "type": "controller",
      "parent_id": null,
      "extent": null,
      "position": null,
      "size": null,
      "ui": {
        "classes": [
          "ok",
          "succeeded"
        ],
        "badges": [
          "0.03s"
        ]
      },
      "inspector": {
        "pipe_code": "classify_and_respond",
        "pipe_type": "PipeSequence",
        "timing": {
          "started_at": "2026-02-22T09:30:40.555107+00:00",
          "ended_at": "2026-02-22T09:30:40.587708+00:00"
        },
        "io_preview": {
          "inputs": [
            {
              "name": "customer_feedback",
              "concept": "CustomerFeedback",
              "preview": null,
              "size": null,
              "digest": "hTBzz"
            }
          ],
          "outputs": [
            {
              "name": "response",
              "concept": "Response",
              "preview": null,
              "size": null,
              "digest": "XMdLZ"
            }
          ]
        }
      },
      "handles": null
    },
    {
      "id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_1",
      "label": "analyze_sentiment",
      "kind": "operator",
      "status": "succeeded",
      "type": "operator",
      "parent_id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_0",
      "extent": "parent",
      "position": null,
      "size": null,
      "ui": {
        "classes": [
          "ok",
          "succeeded"
        ],
        "badges": [
          "0.01s"
        ]
      },
      "inspector": {
        "pipe_code": "analyze_sentiment",
        "pipe_type": "PipeLLM",
        "timing": {
          "started_at": "2026-02-22T09:30:40.557440+00:00",
          "ended_at": "2026-02-22T09:30:40.568391+00:00"
        },
        "io_preview": {
          "inputs": [
            {
              "name": "customer_feedback",
              "concept": "CustomerFeedback",
              "preview": null,
              "size": null,
              "digest": "hTBzz"
            }
          ],
          "outputs": [
            {
              "name": "sentiment_analysis",
              "concept": "SentimentAnalysis",
              "preview": null,
              "size": null,
              "digest": "aDvdh"
            }
          ]
        }
      },
      "handles": null
    },
    {
      "id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_2",
      "label": "route_response",
      "kind": "controller",
      "status": "succeeded",
      "type": "controller",
      "parent_id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_0",
      "extent": "parent",
      "position": null,
      "size": null,
      "ui": {
        "classes": [
          "ok",
          "succeeded"
        ],
        "badges": [
          "0.02s"
        ]
      },
      "inspector": {
        "pipe_code": "route_response",
        "pipe_type": "PipeCondition",
        "timing": {
          "started_at": "2026-02-22T09:30:40.568412+00:00",
          "ended_at": "2026-02-22T09:30:40.586900+00:00"
        },
        "io_preview": {
          "inputs": [
            {
              "name": "sentiment_analysis",
              "concept": "SentimentAnalysis",
              "preview": null,
              "size": null,
              "digest": "aDvdh"
            },
            {
              "name": "customer_feedback",
              "concept": "CustomerFeedback",
              "preview": null,
              "size": null,
              "digest": "hTBzz"
            }
          ],
          "outputs": [
            {
              "name": "response",
              "concept": "Response",
              "preview": null,
              "size": null,
              "digest": "XMdLZ"
            }
          ]
        }
      },
      "handles": null
    },
    {
      "id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_3",
      "label": "respond_negative",
      "kind": "operator",
      "status": "succeeded",
      "type": "operator",
      "parent_id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_2",
      "extent": "parent",
      "position": null,
      "size": null,
      "ui": {
        "classes": [
          "ok",
          "succeeded"
        ],
        "badges": [
          "0.00s"
        ]
      },
      "inspector": {
        "pipe_code": "respond_negative",
        "pipe_type": "PipeCompose",
        "timing": {
          "started_at": "2026-02-22T09:30:40.570845+00:00",
          "ended_at": "2026-02-22T09:30:40.575640+00:00"
        },
        "io_preview": {
          "inputs": [
            {
              "name": "customer_feedback",
              "concept": "CustomerFeedback",
              "preview": null,
              "size": null,
              "digest": "hTBzz"
            },
            {
              "name": "sentiment_analysis",
              "concept": "SentimentAnalysis",
              "preview": null,
              "size": null,
              "digest": "aDvdh"
            }
          ],
          "outputs": [
            {
              "name": "response",
              "concept": "Response",
              "preview": null,
              "size": null,
              "digest": "fhuAf"
            }
          ]
        }
      },
      "handles": null
    },
    {
      "id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_4",
      "label": "respond_positive",
      "kind": "operator",
      "status": "succeeded",
      "type": "operator",
      "parent_id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_2",
      "extent": "parent",
      "position": null,
      "size": null,
      "ui": {
        "classes": [
          "ok",
          "succeeded"
        ],
        "badges": [
          "0.00s"
        ]
      },
      "inspector": {
        "pipe_code": "respond_positive",
        "pipe_type": "PipeCompose",
        "timing": {
          "started_at": "2026-02-22T09:30:40.575652+00:00",
          "ended_at": "2026-02-22T09:30:40.580474+00:00"
        },
        "io_preview": {
          "inputs": [
            {
              "name": "customer_feedback",
              "concept": "CustomerFeedback",
              "preview": null,
              "size": null,
              "digest": "hTBzz"
            },
            {
              "name": "sentiment_analysis",
              "concept": "SentimentAnalysis",
              "preview": null,
              "size": null,
              "digest": "aDvdh"
            }
          ],
          "outputs": [
            {
              "name": "response",
              "concept": "Response",
              "preview": null,
              "size": null,
              "digest": "H8zKj"
            }
          ]
        }
      },
      "handles": null
    },
    {
      "id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_5",
      "label": "respond_neutral",
      "kind": "operator",
      "status": "succeeded",
      "type": "operator",
      "parent_id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_2",
      "extent": "parent",
      "position": null,
      "size": null,
      "ui": {
        "classes": [
          "ok",
          "succeeded"
        ],
        "badges": [
          "0.01s"
        ]
      },
      "inspector": {
        "pipe_code": "respond_neutral",
        "pipe_type": "PipeCompose",
        "timing": {
          "started_at": "2026-02-22T09:30:40.580484+00:00",
          "ended_at": "2026-02-22T09:30:40.586037+00:00"
        },
        "io_preview": {
          "inputs": [
            {
              "name": "customer_feedback",
              "concept": "CustomerFeedback",
              "preview": null,
              "size": null,
              "digest": "hTBzz"
            },
            {
              "name": "sentiment_analysis",
              "concept": "SentimentAnalysis",
              "preview": null,
              "size": null,
              "digest": "aDvdh"
            }
          ],
          "outputs": [
            {
              "name": "response",
              "concept": "Response",
              "preview": null,
              "size": null,
              "digest": "XMdLZ"
            }
          ]
        }
      },
      "handles": null
    }
  ],
  "edges": [
    {
      "id": "0075b36d-2197-4d1f-9221-3b92d138a791:edge_5",
      "source": "0075b36d-2197-4d1f-9221-3b92d138a791:node_1",
      "target": "0075b36d-2197-4d1f-9221-3b92d138a791:node_2",
      "kind": "data",
      "label": "sentiment_analysis",
      "type": "data",
      "animated": true,
      "hidden": false,
      "source_handle": null,
      "target_handle": null,
      "ui": {}
    },
    {
      "id": "0075b36d-2197-4d1f-9221-3b92d138a791:edge_6",
      "source": "0075b36d-2197-4d1f-9221-3b92d138a791:node_1",
      "target": "0075b36d-2197-4d1f-9221-3b92d138a791:node_3",
      "kind": "data",
      "label": "sentiment_analysis",
      "type": "data",
      "animated": true,
      "hidden": false,
      "source_handle": null,
      "target_handle": null,
      "ui": {}
    },
    {
      "id": "0075b36d-2197-4d1f-9221-3b92d138a791:edge_7",
      "source": "0075b36d-2197-4d1f-9221-3b92d138a791:node_1",
      "target": "0075b36d-2197-4d1f-9221-3b92d138a791:node_4",
      "kind": "data",
      "label": "sentiment_analysis",
      "type": "data",
      "animated": true,
      "hidden": false,
      "source_handle": null,
      "target_handle": null,
      "ui": {}
    },
    {
      "id": "0075b36d-2197-4d1f-9221-3b92d138a791:edge_8",
      "source": "0075b36d-2197-4d1f-9221-3b92d138a791:node_1",
      "target": "0075b36d-2197-4d1f-9221-3b92d138a791:node_5",
      "kind": "data",
      "label": "sentiment_analysis",
      "type": "data",
      "animated": true,
      "hidden": false,
      "source_handle": null,
      "target_handle": null,
      "ui": {}
    }
  ],
  "index": {
    "edges_by_node": {
      "0075b36d-2197-4d1f-9221-3b92d138a791:node_0": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_0",
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_1"
      ],
      "0075b36d-2197-4d1f-9221-3b92d138a791:node_1": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_0",
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_5",
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_6",
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_7",
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_8"
      ],
      "0075b36d-2197-4d1f-9221-3b92d138a791:node_2": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_1",
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_2",
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_3",
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_4",
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_5"
      ],
      "0075b36d-2197-4d1f-9221-3b92d138a791:node_3": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_2",
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_6"
      ],
      "0075b36d-2197-4d1f-9221-3b92d138a791:node_4": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_3",
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_7"
      ],
      "0075b36d-2197-4d1f-9221-3b92d138a791:node_5": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_4",
        "0075b36d-2197-4d1f-9221-3b92d138a791:edge_8"
      ]
    },
    "children_by_parent": {
      "0075b36d-2197-4d1f-9221-3b92d138a791:node_0": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_1",
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_2"
      ],
      "0075b36d-2197-4d1f-9221-3b92d138a791:node_2": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_3",
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_4",
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_5"
      ]
    },
    "search": {
      "pipe_code:classify_and_respond": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_0"
      ],
      "pipe_type:PipeSequence": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_0"
      ],
      "status:succeeded": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_0",
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_1",
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_2",
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_3",
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_4",
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_5"
      ],
      "pipe_code:analyze_sentiment": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_1"
      ],
      "pipe_type:PipeLLM": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_1"
      ],
      "pipe_code:route_response": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_2"
      ],
      "pipe_type:PipeCondition": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_2"
      ],
      "pipe_code:respond_negative": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_3"
      ],
      "pipe_type:PipeCompose": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_3",
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_4",
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_5"
      ],
      "pipe_code:respond_positive": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_4"
      ],
      "pipe_code:respond_neutral": [
        "0075b36d-2197-4d1f-9221-3b92d138a791:node_5"
      ]
    }
  },
  "payloads": null
}</script>
<!-- Embedded GraphSpec (for dataflow extraction) -->
<script type="application/json" id="pipelex-graphspec">{
  "graph_id": "0075b36d-2197-4d1f-9221-3b92d138a791",
  "created_at": "2026-02-22T09:30:40.542621Z",
  "pipeline_ref": {
    "domain": "customer_feedback_response",
    "main_pipe": "classify_and_respond",
    "entrypoint": null
  },
  "nodes": [
    {
      "node_id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_0",
      "kind": "controller",
      "pipe_code": "classify_and_respond",
      "pipe_type": "PipeSequence",
      "status": "succeeded",
      "timing": {
        "started_at": "2026-02-22T09:30:40.555107Z",
        "ended_at": "2026-02-22T09:30:40.587708Z",
        "duration": 0.032601
      },
      "node_io": {
        "inputs": [
          {
            "name": "customer_feedback",
            "concept": "CustomerFeedback",
            "content_type": null,
            "preview": null,
            "size": null,
            "digest": "hTBzz",
            "data": {
              "text": "ZHAKFmfxFdENzbLyhYVM"
            },
            "data_text": "ZHAKFmfxFdENzbLyhYVM                                                                                \n",
            "data_html": "ZHAKFmfxFdENzbLyhYVM",
            "extra": {}
          }
        ],
        "outputs": [
          {
            "name": "response",
            "concept": "Response",
            "content_type": null,
            "preview": null,
            "size": null,
            "digest": "XMdLZ",
            "data": {
              "text": "Thank you for taking the time to share your feedback with us.\n\nYour input:\nZHAKFmfxFdENzbLyhYVM\n\nWe appreciate you letting us know about your experience. Your feedback helps us understand how we're doing and where we can improve.\n\nAnalysis summary:\n# sentiment: KLCjiXkzVeEODURUvxEl\n\n# confidence: 1.6057574393007\n\n# key_phrases: pCPTHsqnRDUvjtoPkHGo\n\nIf you have any additional thoughts or suggestions, please don't hesitate to reach out. We value your perspective and are always looking for ways to better serve you.\n\nBest regards,\nCustomer Support Team"
            },
            "data_text": "Thank you for taking the time to share your feedback with us.                                       \n\nYour input: ZHAKFmfxFdENzbLyhYVM                                                                    \n\nWe appreciate you letting us know about your experience. Your feedback helps us understand how we're\ndoing and where we can improve.                                                                     \n\nAnalysis summary:                                                                                   \n\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503                                 sentiment: KLCjiXkzVeEODURUvxEl                                  \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503                                   confidence: 1.6057574393007                                    \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503                                key_phrases: pCPTHsqnRDUvjtoPkHGo                                 \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n\nIf you have any additional thoughts or suggestions, please don't hesitate to reach out. We value    \nyour perspective and are always looking for ways to better serve you.                               \n\nBest regards, Customer Support Team                                                                 \n",
            "data_html": "Thank you for taking the time to share your feedback with us.\n\nYour input:\nZHAKFmfxFdENzbLyhYVM\n\nWe appreciate you letting us know about your experience. Your feedback helps us understand how we&#x27;re doing and where we can improve.\n\nAnalysis summary:\n# sentiment: KLCjiXkzVeEODURUvxEl\n\n# confidence: 1.6057574393007\n\n# key_phrases: pCPTHsqnRDUvjtoPkHGo\n\nIf you have any additional thoughts or suggestions, please don&#x27;t hesitate to reach out. We value your perspective and are always looking for ways to better serve you.\n\nBest regards,\nCustomer Support Team",
            "extra": {}
          }
        ]
      },
      "error": null,
      "tags": {},
      "metrics": {}
    },
    {
      "node_id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_1",
      "kind": "operator",
      "pipe_code": "analyze_sentiment",
      "pipe_type": "PipeLLM",
      "status": "succeeded",
      "timing": {
        "started_at": "2026-02-22T09:30:40.557440Z",
        "ended_at": "2026-02-22T09:30:40.568391Z",
        "duration": 0.010951
      },
      "node_io": {
        "inputs": [
          {
            "name": "customer_feedback",
            "concept": "CustomerFeedback",
            "content_type": null,
            "preview": null,
            "size": null,
            "digest": "hTBzz",
            "data": {
              "text": "ZHAKFmfxFdENzbLyhYVM"
            },
            "data_text": "ZHAKFmfxFdENzbLyhYVM                                                                                \n",
            "data_html": "ZHAKFmfxFdENzbLyhYVM",
            "extra": {}
          }
        ],
        "outputs": [
          {
            "name": "sentiment_analysis",
            "concept": "SentimentAnalysis",
            "content_type": null,
            "preview": null,
            "size": null,
            "digest": "aDvdh",
            "data": {
              "sentiment": "KLCjiXkzVeEODURUvxEl",
              "confidence": 1.6057574393007,
              "key_phrases": "pCPTHsqnRDUvjtoPkHGo"
            },
            "data_text": " Attribute                    \u2503 Value                                           \n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n sentiment                    \u2502 KLCjiXkzVeEODURUvxEl                            \n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n confidence                   \u2502 1.6057574393007                                 \n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n key_phrases                  \u2502 pCPTHsqnRDUvjtoPkHGo                            \n",
            "data_html": "<table><tr><th>sentiment</th><td>KLCjiXkzVeEODURUvxEl</td></tr><tr><th>confidence</th><td>1.6057574393007</td></tr><tr><th>key_phrases</th><td>pCPTHsqnRDUvjtoPkHGo</td></tr></table>",
            "extra": {}
          }
        ]
      },
      "error": null,
      "tags": {},
      "metrics": {}
    },
    {
      "node_id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_2",
      "kind": "controller",
      "pipe_code": "route_response",
      "pipe_type": "PipeCondition",
      "status": "succeeded",
      "timing": {
        "started_at": "2026-02-22T09:30:40.568412Z",
        "ended_at": "2026-02-22T09:30:40.586900Z",
        "duration": 0.018488
      },
      "node_io": {
        "inputs": [
          {
            "name": "sentiment_analysis",
            "concept": "SentimentAnalysis",
            "content_type": null,
            "preview": null,
            "size": null,
            "digest": "aDvdh",
            "data": {
              "sentiment": "KLCjiXkzVeEODURUvxEl",
              "confidence": 1.6057574393007,
              "key_phrases": "pCPTHsqnRDUvjtoPkHGo"
            },
            "data_text": " Attribute                    \u2503 Value                                           \n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n sentiment                    \u2502 KLCjiXkzVeEODURUvxEl                            \n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n confidence                   \u2502 1.6057574393007                                 \n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n key_phrases                  \u2502 pCPTHsqnRDUvjtoPkHGo                            \n",
            "data_html": "<table><tr><th>sentiment</th><td>KLCjiXkzVeEODURUvxEl</td></tr><tr><th>confidence</th><td>1.6057574393007</td></tr><tr><th>key_phrases</th><td>pCPTHsqnRDUvjtoPkHGo</td></tr></table>",
            "extra": {}
          },
          {
            "name": "customer_feedback",
            "concept": "CustomerFeedback",
            "content_type": null,
            "preview": null,
            "size": null,
            "digest": "hTBzz",
            "data": {
              "text": "ZHAKFmfxFdENzbLyhYVM"
            },
            "data_text": "ZHAKFmfxFdENzbLyhYVM                                                                                \n",
            "data_html": "ZHAKFmfxFdENzbLyhYVM",
            "extra": {}
          }
        ],
        "outputs": [
          {
            "name": "response",
            "concept": "Response",
            "content_type": null,
            "preview": null,
            "size": null,
            "digest": "XMdLZ",
            "data": {
              "text": "Thank you for taking the time to share your feedback with us.\n\nYour input:\nZHAKFmfxFdENzbLyhYVM\n\nWe appreciate you letting us know about your experience. Your feedback helps us understand how we're doing and where we can improve.\n\nAnalysis summary:\n# sentiment: KLCjiXkzVeEODURUvxEl\n\n# confidence: 1.6057574393007\n\n# key_phrases: pCPTHsqnRDUvjtoPkHGo\n\nIf you have any additional thoughts or suggestions, please don't hesitate to reach out. We value your perspective and are always looking for ways to better serve you.\n\nBest regards,\nCustomer Support Team"
            },
            "data_text": "Thank you for taking the time to share your feedback with us.                                       \n\nYour input: ZHAKFmfxFdENzbLyhYVM                                                                    \n\nWe appreciate you letting us know about your experience. Your feedback helps us understand how we're\ndoing and where we can improve.                                                                     \n\nAnalysis summary:                                                                                   \n\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503                                 sentiment: KLCjiXkzVeEODURUvxEl                                  \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503                                   confidence: 1.6057574393007                                    \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503                                key_phrases: pCPTHsqnRDUvjtoPkHGo                                 \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n\nIf you have any additional thoughts or suggestions, please don't hesitate to reach out. We value    \nyour perspective and are always looking for ways to better serve you.                               \n\nBest regards, Customer Support Team                                                                 \n",
            "data_html": "Thank you for taking the time to share your feedback with us.\n\nYour input:\nZHAKFmfxFdENzbLyhYVM\n\nWe appreciate you letting us know about your experience. Your feedback helps us understand how we&#x27;re doing and where we can improve.\n\nAnalysis summary:\n# sentiment: KLCjiXkzVeEODURUvxEl\n\n# confidence: 1.6057574393007\n\n# key_phrases: pCPTHsqnRDUvjtoPkHGo\n\nIf you have any additional thoughts or suggestions, please don&#x27;t hesitate to reach out. We value your perspective and are always looking for ways to better serve you.\n\nBest regards,\nCustomer Support Team",
            "extra": {}
          }
        ]
      },
      "error": null,
      "tags": {},
      "metrics": {}
    },
    {
      "node_id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_3",
      "kind": "operator",
      "pipe_code": "respond_negative",
      "pipe_type": "PipeCompose",
      "status": "succeeded",
      "timing": {
        "started_at": "2026-02-22T09:30:40.570845Z",
        "ended_at": "2026-02-22T09:30:40.575640Z",
        "duration": 0.004795
      },
      "node_io": {
        "inputs": [
          {
            "name": "customer_feedback",
            "concept": "CustomerFeedback",
            "content_type": null,
            "preview": null,
            "size": null,
            "digest": "hTBzz",
            "data": {
              "text": "ZHAKFmfxFdENzbLyhYVM"
            },
            "data_text": "ZHAKFmfxFdENzbLyhYVM                                                                                \n",
            "data_html": "ZHAKFmfxFdENzbLyhYVM",
            "extra": {}
          },
          {
            "name": "sentiment_analysis",
            "concept": "SentimentAnalysis",
            "content_type": null,
            "preview": null,
            "size": null,
            "digest": "aDvdh",
            "data": {
              "sentiment": "KLCjiXkzVeEODURUvxEl",
              "confidence": 1.6057574393007,
              "key_phrases": "pCPTHsqnRDUvjtoPkHGo"
            },
            "data_text": " Attribute                    \u2503 Value                                           \n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n sentiment                    \u2502 KLCjiXkzVeEODURUvxEl                            \n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n confidence                   \u2502 1.6057574393007                                 \n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n key_phrases                  \u2502 pCPTHsqnRDUvjtoPkHGo                            \n",
            "data_html": "<table><tr><th>sentiment</th><td>KLCjiXkzVeEODURUvxEl</td></tr><tr><th>confidence</th><td>1.6057574393007</td></tr><tr><th>key_phrases</th><td>pCPTHsqnRDUvjtoPkHGo</td></tr></table>",
            "extra": {}
          }
        ],
        "outputs": [
          {
            "name": "response",
            "concept": "Response",
            "content_type": null,
            "preview": null,
            "size": null,
            "digest": "fhuAf",
            "data": {
              "text": "Thank you for taking the time to share your feedback with us.\n\nWe sincerely apologize that your experience did not meet your expectations. We understand your concerns regarding: pCPTHsqnRDUvjtoPkHGo\n\nYour feedback is incredibly valuable to us, and we are committed to addressing these issues. Our team will review your comments carefully and work to improve.\n\nWe would love the opportunity to make things right. Please don't hesitate to reach out to us directly so we can resolve this matter to your satisfaction.\n\nThank you for helping us become better."
            },
            "data_text": "Thank you for taking the time to share your feedback with us.                                       \n\nWe sincerely apologize that your experience did not meet your expectations. We understand your      \nconcerns regarding: pCPTHsqnRDUvjtoPkHGo                                                            \n\nYour feedback is incredibly valuable to us, and we are committed to addressing these issues. Our    \nteam will review your comments carefully and work to improve.                                       \n\nWe would love the opportunity to make things right. Please don't hesitate to reach out to us        \ndirectly so we can resolve this matter to your satisfaction.                                        \n\nThank you for helping us become better.                                                             \n",
            "data_html": "Thank you for taking the time to share your feedback with us.\n\nWe sincerely apologize that your experience did not meet your expectations. We understand your concerns regarding: pCPTHsqnRDUvjtoPkHGo\n\nYour feedback is incredibly valuable to us, and we are committed to addressing these issues. Our team will review your comments carefully and work to improve.\n\nWe would love the opportunity to make things right. Please don&#x27;t hesitate to reach out to us directly so we can resolve this matter to your satisfaction.\n\nThank you for helping us become better.",
            "extra": {}
          }
        ]
      },
      "error": null,
      "tags": {},
      "metrics": {}
    },
    {
      "node_id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_4",
      "kind": "operator",
      "pipe_code": "respond_positive",
      "pipe_type": "PipeCompose",
      "status": "succeeded",
      "timing": {
        "started_at": "2026-02-22T09:30:40.575652Z",
        "ended_at": "2026-02-22T09:30:40.580474Z",
        "duration": 0.004822
      },
      "node_io": {
        "inputs": [
          {
            "name": "customer_feedback",
            "concept": "CustomerFeedback",
            "content_type": null,
            "preview": null,
            "size": null,
            "digest": "hTBzz",
            "data": {
              "text": "ZHAKFmfxFdENzbLyhYVM"
            },
            "data_text": "ZHAKFmfxFdENzbLyhYVM                                                                                \n",
            "data_html": "ZHAKFmfxFdENzbLyhYVM",
            "extra": {}
          },
          {
            "name": "sentiment_analysis",
            "concept": "SentimentAnalysis",
            "content_type": null,
            "preview": null,
            "size": null,
            "digest": "aDvdh",
            "data": {
              "sentiment": "KLCjiXkzVeEODURUvxEl",
              "confidence": 1.6057574393007,
              "key_phrases": "pCPTHsqnRDUvjtoPkHGo"
            },
            "data_text": " Attribute                    \u2503 Value                                           \n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n sentiment                    \u2502 KLCjiXkzVeEODURUvxEl                            \n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n confidence                   \u2502 1.6057574393007                                 \n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n key_phrases                  \u2502 pCPTHsqnRDUvjtoPkHGo                            \n",
            "data_html": "<table><tr><th>sentiment</th><td>KLCjiXkzVeEODURUvxEl</td></tr><tr><th>confidence</th><td>1.6057574393007</td></tr><tr><th>key_phrases</th><td>pCPTHsqnRDUvjtoPkHGo</td></tr></table>",
            "extra": {}
          }
        ],
        "outputs": [
          {
            "name": "response",
            "concept": "Response",
            "content_type": null,
            "preview": null,
            "size": null,
            "digest": "H8zKj",
            "data": {
              "text": "Thank you so much for your wonderful feedback! We're thrilled to hear about your positive experience.\n\nYour feedback:\nZHAKFmfxFdENzbLyhYVM\n\nWe truly appreciate you taking the time to share your thoughts with us. Your kind words motivate our team to continue delivering excellent service. We look forward to serving you again!"
            },
            "data_text": "Thank you so much for your wonderful feedback! We're thrilled to hear about your positive           \nexperience.                                                                                         \n\nYour feedback: ZHAKFmfxFdENzbLyhYVM                                                                 \n\nWe truly appreciate you taking the time to share your thoughts with us. Your kind words motivate our\nteam to continue delivering excellent service. We look forward to serving you again!                \n",
            "data_html": "Thank you so much for your wonderful feedback! We&#x27;re thrilled to hear about your positive experience.\n\nYour feedback:\nZHAKFmfxFdENzbLyhYVM\n\nWe truly appreciate you taking the time to share your thoughts with us. Your kind words motivate our team to continue delivering excellent service. We look forward to serving you again!",
            "extra": {}
          }
        ]
      },
      "error": null,
      "tags": {},
      "metrics": {}
    },
    {
      "node_id": "0075b36d-2197-4d1f-9221-3b92d138a791:node_5",
      "kind": "operator",
      "pipe_code": "respond_neutral",
      "pipe_type": "PipeCompose",
      "status": "succeeded",
      "timing": {
        "started_at": "2026-02-22T09:30:40.580484Z",
        "ended_at": "2026-02-22T09:30:40.586037Z",
        "duration": 0.005553
      },
      "node_io": {
        "inputs": [
          {
            "name": "customer_feedback",
            "concept": "CustomerFeedback",
            "content_type": null,
            "preview": null,
            "size": null,
            "digest": "hTBzz",
            "data": {
              "text": "ZHAKFmfxFdENzbLyhYVM"
            },
            "data_text": "ZHAKFmfxFdENzbLyhYVM                                                                                \n",
            "data_html": "ZHAKFmfxFdENzbLyhYVM",
            "extra": {}
          },
          {
            "name": "sentiment_analysis",
            "concept": "SentimentAnalysis",
            "content_type": null,
            "preview": null,
            "size": null,
            "digest": "aDvdh",
            "data": {
              "sentiment": "KLCjiXkzVeEODURUvxEl",
              "confidence": 1.6057574393007,
              "key_phrases": "pCPTHsqnRDUvjtoPkHGo"
            },
            "data_text": " Attribute                    \u2503 Value                                           \n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n sentiment                    \u2502 KLCjiXkzVeEODURUvxEl                            \n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n confidence                   \u2502 1.6057574393007                                 \n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n key_phrases                  \u2502 pCPTHsqnRDUvjtoPkHGo                            \n",
            "data_html": "<table><tr><th>sentiment</th><td>KLCjiXkzVeEODURUvxEl</td></tr><tr><th>confidence</th><td>1.6057574393007</td></tr><tr><th>key_phrases</th><td>pCPTHsqnRDUvjtoPkHGo</td></tr></table>",
            "extra": {}
          }
        ],
        "outputs": [
          {
            "name": "response",
            "concept": "Response",
            "content_type": null,
            "preview": null,
            "size": null,
            "digest": "XMdLZ",
            "data": {
              "text": "Thank you for taking the time to share your feedback with us.\n\nYour input:\nZHAKFmfxFdENzbLyhYVM\n\nWe appreciate you letting us know about your experience. Your feedback helps us understand how we're doing and where we can improve.\n\nAnalysis summary:\n# sentiment: KLCjiXkzVeEODURUvxEl\n\n# confidence: 1.6057574393007\n\n# key_phrases: pCPTHsqnRDUvjtoPkHGo\n\nIf you have any additional thoughts or suggestions, please don't hesitate to reach out. We value your perspective and are always looking for ways to better serve you.\n\nBest regards,\nCustomer Support Team"
            },
            "data_text": "Thank you for taking the time to share your feedback with us.                                       \n\nYour input: ZHAKFmfxFdENzbLyhYVM                                                                    \n\nWe appreciate you letting us know about your experience. Your feedback helps us understand how we're\ndoing and where we can improve.                                                                     \n\nAnalysis summary:                                                                                   \n\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503                                 sentiment: KLCjiXkzVeEODURUvxEl                                  \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503                                   confidence: 1.6057574393007                                    \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503                                key_phrases: pCPTHsqnRDUvjtoPkHGo                                 \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n\nIf you have any additional thoughts or suggestions, please don't hesitate to reach out. We value    \nyour perspective and are always looking for ways to better serve you.                               \n\nBest regards, Customer Support Team                                                                 \n",
            "data_html": "Thank you for taking the time to share your feedback with us.\n\nYour input:\nZHAKFmfxFdENzbLyhYVM\n\nWe appreciate you letting us know about your experience. Your feedback helps us understand how we&#x27;re doing and where we can improve.\n\nAnalysis summary:\n# sentiment: KLCjiXkzVeEODURUvxEl\n\n# confidence: 1.6057574393007\n\n# key_phrases: pCPTHsqnRDUvjtoPkHGo\n\nIf you have any additional thoughts or suggestions, please don&#x27;t hesitate to reach out. We value your perspective and are always looking for ways to better serve you.\n\nBest regards,\nCustomer Support Team",
            "extra": {}
          }
        ]
      },
      "error": null,
      "tags": {},
      "metrics": {}
    }
  ],
  "edges": [
    {
      "edge_id": "0075b36d-2197-4d1f-9221-3b92d138a791:edge_0",
      "source": "0075b36d-2197-4d1f-9221-3b92d138a791:node_0",
      "target": "0075b36d-2197-4d1f-9221-3b92d138a791:node_1",
      "kind": "contains",
      "label": null,
      "source_stuff_digest": null,
      "target_stuff_digest": null,
      "meta": {}
    },
    {
      "edge_id": "0075b36d-2197-4d1f-9221-3b92d138a791:edge_1",
      "source": "0075b36d-2197-4d1f-9221-3b92d138a791:node_0",
      "target": "0075b36d-2197-4d1f-9221-3b92d138a791:node_2",
      "kind": "contains",
      "label": null,
      "source_stuff_digest": null,
      "target_stuff_digest": null,
      "meta": {}
    },
    {
      "edge_id": "0075b36d-2197-4d1f-9221-3b92d138a791:edge_2",
      "source": "0075b36d-2197-4d1f-9221-3b92d138a791:node_2",
      "target": "0075b36d-2197-4d1f-9221-3b92d138a791:node_3",
      "kind": "contains",
      "label": null,
      "source_stuff_digest": null,
      "target_stuff_digest": null,
      "meta": {}
    },
    {
      "edge_id": "0075b36d-2197-4d1f-9221-3b92d138a791:edge_3",
      "source": "0075b36d-2197-4d1f-9221-3b92d138a791:node_2",
      "target": "0075b36d-2197-4d1f-9221-3b92d138a791:node_4",
      "kind": "contains",
      "label": null,
      "source_stuff_digest": null,
      "target_stuff_digest": null,
      "meta": {}
    },
    {
      "edge_id": "0075b36d-2197-4d1f-9221-3b92d138a791:edge_4",
      "source": "0075b36d-2197-4d1f-9221-3b92d138a791:node_2",
      "target": "0075b36d-2197-4d1f-9221-3b92d138a791:node_5",
      "kind": "contains",
      "label": null,
      "source_stuff_digest": null,
      "target_stuff_digest": null,
      "meta": {}
    },
    {
      "edge_id": "0075b36d-2197-4d1f-9221-3b92d138a791:edge_5",
      "source": "0075b36d-2197-4d1f-9221-3b92d138a791:node_1",
      "target": "0075b36d-2197-4d1f-9221-3b92d138a791:node_2",
      "kind": "data",
      "label": "sentiment_analysis",
      "source_stuff_digest": null,
      "target_stuff_digest": null,
      "meta": {}
    },
    {
      "edge_id": "0075b36d-2197-4d1f-9221-3b92d138a791:edge_6",
      "source": "0075b36d-2197-4d1f-9221-3b92d138a791:node_1",
      "target": "0075b36d-2197-4d1f-9221-3b92d138a791:node_3",
      "kind": "data",
      "label": "sentiment_analysis",
      "source_stuff_digest": null,
      "target_stuff_digest": null,
      "meta": {}
    },
    {
      "edge_id": "0075b36d-2197-4d1f-9221-3b92d138a791:edge_7",
      "source": "0075b36d-2197-4d1f-9221-3b92d138a791:node_1",
      "target": "0075b36d-2197-4d1f-9221-3b92d138a791:node_4",
      "kind": "data",
      "label": "sentiment_analysis",
      "source_stuff_digest": null,
      "target_stuff_digest": null,
      "meta": {}
    },
    {
      "edge_id": "0075b36d-2197-4d1f-9221-3b92d138a791:edge_8",
      "source": "0075b36d-2197-4d1f-9221-3b92d138a791:node_1",
      "target": "0075b36d-2197-4d1f-9221-3b92d138a791:node_5",
      "kind": "data",
      "label": "sentiment_analysis",
      "source_stuff_digest": null,
      "target_stuff_digest": null,
      "meta": {}
    }
  ],
  "meta": {}
}</script>
<!-- Embedded stuff data in multiple formats for display toggle -->
<script type="application/json" id="pipelex-stuff-data-text">{"s_f63d937810": "Thank you for taking the time to share your feedback with us.                                       \n\nYour input: ZHAKFmfxFdENzbLyhYVM                                                                    \n\nWe appreciate you letting us know about your experience. Your feedback helps us understand how we're\ndoing and where we can improve.                                                                     \n\nAnalysis summary:                                                                                   \n\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503                                 sentiment: KLCjiXkzVeEODURUvxEl                                  \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503                                   confidence: 1.6057574393007                                    \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503                                key_phrases: pCPTHsqnRDUvjtoPkHGo                                 \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n\nIf you have any additional thoughts or suggestions, please don't hesitate to reach out. We value    \nyour perspective and are always looking for ways to better serve you.                               \n\nBest regards, Customer Support Team                                                                 \n", "s_7d307af73c": "ZHAKFmfxFdENzbLyhYVM                                                                                \n", "s_226adef39e": " Attribute                    \u2503 Value                                           \n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2547\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n sentiment                    \u2502 KLCjiXkzVeEODURUvxEl                            \n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n confidence                   \u2502 1.6057574393007                                 \n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n key_phrases                  \u2502 pCPTHsqnRDUvjtoPkHGo                            \n", "s_a83c40810c": "Thank you for taking the time to share your feedback with us.                                       \n\nWe sincerely apologize that your experience did not meet your expectations. We understand your      \nconcerns regarding: pCPTHsqnRDUvjtoPkHGo                                                            \n\nYour feedback is incredibly valuable to us, and we are committed to addressing these issues. Our    \nteam will review your comments carefully and work to improve.                                       \n\nWe would love the opportunity to make things right. Please don't hesitate to reach out to us        \ndirectly so we can resolve this matter to your satisfaction.                                        \n\nThank you for helping us become better.                                                             \n", "s_af0a6b1b8a": "Thank you so much for your wonderful feedback! We're thrilled to hear about your positive           \nexperience.                                                                                         \n\nYour feedback: ZHAKFmfxFdENzbLyhYVM                                                                 \n\nWe truly appreciate you taking the time to share your thoughts with us. Your kind words motivate our\nteam to continue delivering excellent service. We look forward to serving you again!                \n"}</script>
<script type="application/json" id="pipelex-stuff-data-html">{"s_f63d937810": "Thank you for taking the time to share your feedback with us.\n\nYour input:\nZHAKFmfxFdENzbLyhYVM\n\nWe appreciate you letting us know about your experience. Your feedback helps us understand how we&#x27;re doing and where we can improve.\n\nAnalysis summary:\n# sentiment: KLCjiXkzVeEODURUvxEl\n\n# confidence: 1.6057574393007\n\n# key_phrases: pCPTHsqnRDUvjtoPkHGo\n\nIf you have any additional thoughts or suggestions, please don&#x27;t hesitate to reach out. We value your perspective and are always looking for ways to better serve you.\n\nBest regards,\nCustomer Support Team", "s_7d307af73c": "ZHAKFmfxFdENzbLyhYVM", "s_226adef39e": "<table><tr><th>sentiment</th><td>KLCjiXkzVeEODURUvxEl</td></tr><tr><th>confidence</th><td>1.6057574393007</td></tr><tr><th>key_phrases</th><td>pCPTHsqnRDUvjtoPkHGo</td></tr></table>", "s_a83c40810c": "Thank you for taking the time to share your feedback with us.\n\nWe sincerely apologize that your experience did not meet your expectations. We understand your concerns regarding: pCPTHsqnRDUvjtoPkHGo\n\nYour feedback is incredibly valuable to us, and we are committed to addressing these issues. Our team will review your comments carefully and work to improve.\n\nWe would love the opportunity to make things right. Please don&#x27;t hesitate to reach out to us directly so we can resolve this matter to your satisfaction.\n\nThank you for helping us become better.", "s_af0a6b1b8a": "Thank you so much for your wonderful feedback! We&#x27;re thrilled to hear about your positive experience.\n\nYour feedback:\nZHAKFmfxFdENzbLyhYVM\n\nWe truly appreciate you taking the time to share your thoughts with us. Your kind words motivate our team to continue delivering excellent service. We look forward to serving you again!"}</script>
    <script nonce="PIPELEX_CSP_NONCE">
const themes = ['dark', 'light', 'system'];
const initialTheme = "dark";
let currentThemeIndex = themes.indexOf(localStorage.getItem('pipelex-theme') || initialTheme);
if (currentThemeIndex === -1) currentThemeIndex = 0;

// Layout direction toggle
const initialDirection = "TB";
let currentDirection = initialDirection;

const palette = "dracula";

function applyPalette(palette) {
    document.documentElement.setAttribute('data-palette', palette);
}

function applyTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('pipelex-theme', theme);
    // Update button icons
    document.querySelectorAll('.theme-icon').forEach(icon => icon.classList.remove('active'));
    const activeIcon = document.querySelector(`.${theme}-icon`);
    if (activeIcon) activeIcon.classList.add('active');
}

// Set up theme toggle button
document.getElementById('theme-toggle').addEventListener('click', () => {
    currentThemeIndex = (currentThemeIndex + 1) % themes.length;
    applyTheme(themes[currentThemeIndex]);
});

// Apply initial theme and palette immediately
applyTheme(themes[currentThemeIndex]);
applyPalette(palette);

// Apply direction icon: show the direction we will switch TO (opposite of current)
function applyDirectionIcon(direction) {
    document.querySelectorAll('.direction-icon').forEach(icon => icon.classList.remove('active'));
    const targetIcon = document.querySelector(direction === 'LR' ? '.tb-icon' : '.lr-icon');
    if (targetIcon) targetIcon.classList.add('active');
}
applyDirectionIcon(currentDirection);

// Set up direction toggle button
document.getElementById('direction-toggle').addEventListener('click', () => {
    currentDirection = currentDirection === 'LR' ? 'TB' : 'LR';
    applyDirectionIcon(currentDirection);
    if (window.setLayoutDirection) window.setLayoutDirection(currentDirection);
});

// Parse embedded ViewSpec
const viewspecElement = document.getElementById('pipelex-viewspec');
const viewspec = JSON.parse(viewspecElement.textContent);

// Parse GraphSpec if present
const graphspecElement = document.getElementById('pipelex-graphspec');
const graphspec = graphspecElement ? JSON.parse(graphspecElement.textContent) : null;

// Parse stuff data in alternate formats (for display toggle)
const stuffDataTextElement = document.getElementById('pipelex-stuff-data-text');
const stuffDataText = stuffDataTextElement ? JSON.parse(stuffDataTextElement.textContent || '{}') : {};
const stuffDataHtmlElement = document.getElementById('pipelex-stuff-data-html');
const stuffDataHtml = stuffDataHtmlElement ? JSON.parse(stuffDataHtmlElement.textContent || '{}') : {};

// Track current format selection for stuff display
let currentStuffFormat = 'html';

// ====================================================================
// DATAFLOW ANALYSIS: Extract stuff nodes and build producer/consumer maps
// This mirrors the Python GraphAnalysis logic
// ====================================================================
function buildDataflowAnalysis(graphspec) {
    if (!graphspec) return null;

    const stuffRegistry = {};      // digest -> { name, concept, data, dataText, dataHtml }
    const stuffProducers = {};     // digest -> producer_node_id
    const stuffConsumers = {};     // digest -> [consumer_node_ids]
    const containmentTree = {};    // parent_id -> [child_ids]
    const childNodeIds = new Set();

    // Build containment tree from edges
    for (const edge of graphspec.edges) {
        if (edge.kind === 'contains') {
            if (!containmentTree[edge.source]) containmentTree[edge.source] = [];
            containmentTree[edge.source].push(edge.target);
            childNodeIds.add(edge.target);
        }
    }

    // Controller IDs are nodes that have children
    const controllerNodeIds = new Set(Object.keys(containmentTree));

    // Process all nodes to register stuffs
    // Two passes: first register all stuffs, then build producer/consumer maps for operators only
    for (const node of graphspec.nodes) {
        const nodeIo = node.node_io || {};
        const isController = controllerNodeIds.has(node.node_id);

        // Register outputs to stuffRegistry from ALL nodes (including controllers for batch aggregates)
        for (const output of (nodeIo.outputs || [])) {
            if (output.digest && !stuffRegistry[output.digest]) {
                stuffRegistry[output.digest] = {
                    name: output.name,
                    concept: output.concept,
                    contentType: output.content_type,
                    data: output.data,
                    dataText: output.data_text,
                    dataHtml: output.data_html,
                };
            }
            // Only track operators as producers for data flow edges (not controllers)
            if (output.digest && !isController) {
                stuffProducers[output.digest] = node.node_id;
            }
        }

        // Register inputs to stuffRegistry (pipeline inputs may not have producers)
        for (const input of (nodeIo.inputs || [])) {
            if (input.digest && !stuffRegistry[input.digest]) {
                stuffRegistry[input.digest] = {
                    name: input.name,
                    concept: input.concept,
                    contentType: input.content_type,
                    data: input.data,
                    dataText: input.data_text,
                    dataHtml: input.data_html,
                };
            }
            // Only track operators as consumers for data flow edges (not controllers)
            if (input.digest && !isController) {
                if (!stuffConsumers[input.digest]) stuffConsumers[input.digest] = [];
                stuffConsumers[input.digest].push(node.node_id);
            }
        }
    }

    return {
        stuffRegistry,
        stuffProducers,
        stuffConsumers,
        controllerNodeIds,
        childNodeIds,
    };
}

const dataflowAnalysis = buildDataflowAnalysis(graphspec);
const hasDataflow = dataflowAnalysis && Object.keys(dataflowAnalysis.stuffRegistry).length > 0;

// Update footer stats
const statsEl = document.getElementById('footer-stats');
const pipeCount = hasDataflow
    ? graphspec.nodes.filter(n => !dataflowAnalysis.controllerNodeIds.has(n.node_id)).length
    : viewspec.nodes.length;
const stuffCount = hasDataflow ? Object.keys(dataflowAnalysis.stuffRegistry).length : 0;
const succeededCount = viewspec.nodes.filter(n => n.status === 'succeeded').length;
const failedCount = viewspec.nodes.filter(n => n.status === 'failed').length;

statsEl.innerHTML = `
    <div class="stat-item">
        <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2"/>
        </svg>
        <span class="stat-value">${pipeCount}</span> pipes
    </div>
    ${stuffCount > 0 ? `<div class="stat-item" style="color: var(--color-stuff)">
        <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <ellipse cx="12" cy="12" rx="10" ry="6"/>
        </svg>
        <span class="stat-value">${stuffCount}</span> data
    </div>` : ''}
    ${succeededCount > 0 ? `<div class="stat-item" style="color: var(--color-success)">
        <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
        </svg>
        <span class="stat-value">${succeededCount}</span>
    </div>` : ''}
    ${failedCount > 0 ? `<div class="stat-item" style="color: var(--color-error)">
        <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>
        </svg>
        <span class="stat-value">${failedCount}</span>
    </div>` : ''}
`;

// ReactFlow setup
const { React, ReactDOM } = window;
const ReactFlowLib = window.ReactFlowRenderer || window.ReactFlow || {};
const { ReactFlow, useNodesState, useEdgesState, Background, Controls, MarkerType } = ReactFlowLib;

// Dagre layout function
function getLayoutedElements(nodes, edges, direction = 'TB') {
    const g = new dagre.graphlib.Graph();
    g.setDefaultEdgeLabel(() => ({}));
    g.setGraph({
        rankdir: direction,
        nodesep: 50,
        ranksep: 30,
        edgesep: 20,
        marginx: 40,
        marginy: 40,
    });

    nodes.forEach((node) => {
        const nodeData = node.data || {};
        const isStuff = nodeData.isStuff;
        // Estimate width based on label length (rough: 8px per character + padding)
        const labelText = nodeData.label?.props?.children?.[0]?.props?.children || '';
        const estimatedWidth = Math.max(180, Math.min(400, labelText.length * 8 + 60));
        const width = isStuff ? Math.max(180, estimatedWidth) : Math.max(200, estimatedWidth);
        const height = isStuff ? 60 : 70;
        g.setNode(node.id, { width, height });
    });

    edges.forEach((edge) => {
        g.setEdge(edge.source, edge.target);
    });

    dagre.layout(g);

    // Determine handle positions based on layout direction
    const isHorizontal = direction === 'LR' || direction === 'RL';
    const sourcePosition = isHorizontal ? 'right' : 'bottom';
    const targetPosition = isHorizontal ? 'left' : 'top';

    const layoutedNodes = nodes.map((node) => {
        const nodeWithPosition = g.node(node.id);
        const nodeData = node.data || {};
        const isStuff = nodeData.isStuff;
        const width = isStuff ? 180 : 200;
        return {
            ...node,
            position: {
                x: nodeWithPosition.x - width / 2,
                y: nodeWithPosition.y - 30,
            },
            sourcePosition,
            targetPosition,
        };
    });

    return { nodes: layoutedNodes, edges };
}

// ====================================================================
// BUILD DATAFLOW NODES AND EDGES
// ====================================================================
function buildDataflowGraph(graphspec, analysis) {
    const nodes = [];
    const edges = [];
    const nodeIdMap = {};  // original node_id -> graphspec node

    // Map node IDs to nodes
    for (const node of graphspec.nodes) {
        nodeIdMap[node.node_id] = node;
    }

    // Find participating pipes (those that produce or consume data)
    const participatingPipes = new Set();
    for (const producer of Object.values(analysis.stuffProducers)) {
        participatingPipes.add(producer);
    }
    for (const consumers of Object.values(analysis.stuffConsumers)) {
        for (const consumer of consumers) {
            participatingPipes.add(consumer);
        }
    }

    // In controller-centric mode, include batch controllers as participating pipes
    // so they appear in the graph as hub nodes for batch edges
    const showBatchController = false;
    if (showBatchController) {
        for (const edge of graphspec.edges) {
            if (edge.kind === 'batch_item') {
                // For batch_item edges, edge.source is the batch controller
                participatingPipes.add(edge.source);
            } else if (edge.kind === 'batch_aggregate') {
                // For batch_aggregate edges, edge.target is the batch controller
                participatingPipes.add(edge.target);
            }
        }
    }

    // Build batch index map: stuff_digest -> index label (e.g., "[0]", "[1]")
    // This is used to add index suffixes to batch item node labels
    const showBatchItemIndex = false;
    const batchItemIndexMap = {};  // stuff_digest -> index string
    if (showBatchItemIndex) {
        for (const edge of graphspec.edges) {
            if (edge.kind === 'batch_item' && edge.label && edge.target_stuff_digest) {
                // batch_item edge: target is the item, label contains the index
                batchItemIndexMap[edge.target_stuff_digest] = edge.label;
            } else if (edge.kind === 'batch_aggregate' && edge.label && edge.source_stuff_digest) {
                // batch_aggregate edge: source is the item, label contains the index
                batchItemIndexMap[edge.source_stuff_digest] = edge.label;
            }
        }
    }

    // Create pipe nodes (only those that participate in data flow)
    for (const node of graphspec.nodes) {
        if (!participatingPipes.has(node.node_id)) continue;

        const isFailed = node.status === 'failed';
        const label = node.pipe_code || node.node_id.split(':').pop();
        // Calculate width: ~8px per char (monospace 13px) + padding (28px)
        const nodeWidth = Math.max(160, label.length * 8 + 28);

        nodes.push({
            id: node.node_id,
            type: 'default',
            data: {
                label: React.createElement('div', {
                    style: {
                        padding: '10px 14px',
                        display: 'flex',
                        flexDirection: 'column',
                        gap: '2px',
                        textAlign: 'center',
                    }
                },
                    React.createElement('span', {
                        style: {
                            fontFamily: "'JetBrains Mono', monospace",
                            fontSize: '13px',
                            fontWeight: 600,
                            color: 'var(--color-pipe-text)',
                        }
                    }, label)
                ),
                nodeData: node,
                isPipe: true,
                isStuff: false,
            },
            position: { x: 0, y: 0 },
            style: {
                background: isFailed ? 'var(--color-pipe-failed-bg)' : 'var(--color-pipe-bg)',
                border: isFailed ? '2px solid var(--color-pipe-failed)' : '2px solid var(--color-pipe)',
                borderRadius: '8px',
                padding: '0',
                width: nodeWidth + 'px',
                boxShadow: 'var(--shadow-md)',
            },
        });
    }

    // Create stuff nodes
    for (const [digest, stuffInfo] of Object.entries(analysis.stuffRegistry)) {
        const stuffId = `stuff_${digest}`;
        const baseName = stuffInfo.name;
        // Append batch index to label if available (e.g., "topic" -> "topic[0]")
        // But only if the name doesn't already end with an index like [0], [1], etc.
        const batchIndex = batchItemIndexMap[digest] || '';
        const alreadyHasIndex = /\[\d+\]$/.test(baseName);
        const label = alreadyHasIndex ? baseName : baseName + batchIndex;
        const concept = stuffInfo.concept || '';
        // For pill shape, need extra padding. ~7px per char (12px font) + side padding (48px)
        const textWidth = Math.max(label.length, concept.length) * 7 + 48;
        const stuffWidth = Math.max(140, textWidth);

        nodes.push({
            id: stuffId,
            type: 'default',
            data: {
                label: React.createElement('div', {
                    style: {
                        padding: '8px 24px',
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        gap: '2px',
                        textAlign: 'center',
                    }
                },
                    React.createElement('span', {
                        style: {
                            fontFamily: "'JetBrains Mono', monospace",
                            fontSize: '12px',
                            fontWeight: 600,
                            color: 'var(--color-stuff-text)',
                        }
                    }, label),
                    concept && React.createElement('span', {
                        style: {
                            fontSize: '14px',
                            color: 'var(--color-stuff-text-dim)',
                        }
                    }, concept)
                ),
                stuffData: stuffInfo,
                stuffDigest: digest,
                isStuff: true,
                isPipe: false,
            },
            position: { x: 0, y: 0 },
            style: {
                background: 'var(--color-stuff-bg)',
                border: '2px solid var(--color-stuff-border)',
                borderRadius: '999px',  // Pill shape
                padding: '0',
                width: stuffWidth + 'px',
                boxShadow: 'var(--shadow-md)',
                cursor: 'pointer',
            },
        });
    }

    // Create edges: producer -> stuff
    let edgeId = 0;
    for (const [digest, producerNodeId] of Object.entries(analysis.stuffProducers)) {
        const stuffId = `stuff_${digest}`;
        edges.push({
            id: `edge_${edgeId++}`,
            source: producerNodeId,
            target: stuffId,
            type: "bezier",
            animated: false,
            style: {
                stroke: 'var(--color-edge)',
                strokeWidth: 2,
            },
            markerEnd: {
                type: MarkerType?.ArrowClosed || 'arrowclosed',
                color: 'var(--color-edge)',
            },
        });
    }

    // Create edges: stuff -> consumer
    for (const [digest, consumers] of Object.entries(analysis.stuffConsumers)) {
        const stuffId = `stuff_${digest}`;
        for (const consumerNodeId of consumers) {
            edges.push({
                id: `edge_${edgeId++}`,
                source: stuffId,
                target: consumerNodeId,
                type: "bezier",
                animated: false,
                style: {
                    stroke: 'var(--color-edge)',
                    strokeWidth: 2,
                },
                markerEnd: {
                    type: MarkerType?.ArrowClosed || 'arrowclosed',
                    color: 'var(--color-edge)',
                },
            });
        }
    }

    // Create batch edges (BATCH_ITEM and BATCH_AGGREGATE) from GraphSpec
    // Two modes:
    // - Data-centric (showBatchController=false): edges connect stuff nodes directly
    //   batch_item: stuff_list ‚Üí stuff_item, batch_aggregate: stuff_item ‚Üí stuff_list
    // - Controller-centric (showBatchController=true): batch controller is the hub
    //   batch_item: batch_controller ‚Üí stuff_item, batch_aggregate: stuff_item ‚Üí batch_controller
    // (showBatchController is declared earlier in the function)

    // Create PARALLEL_COMBINE edges from GraphSpec
    // These show branch outputs flowing into the combined output
    for (const edge of graphspec.edges) {
        if (edge.kind !== 'parallel_combine') continue;

        if (!edge.source_stuff_digest || !edge.target_stuff_digest) continue;
        const sourceId = `stuff_${edge.source_stuff_digest}`;
        const targetId = `stuff_${edge.target_stuff_digest}`;

        edges.push({
            id: edge.id,
            source: sourceId,
            target: targetId,
            type: "bezier",
            animated: false,
            style: {
                stroke: 'var(--color-parallel-combine)',
                strokeWidth: 2,
                strokeDasharray: '5,5',
            },
            markerEnd: {
                type: MarkerType?.ArrowClosed || 'arrowclosed',
                color: 'var(--color-parallel-combine)',
            },
        });
    }

    for (const edge of graphspec.edges) {
        if (edge.kind !== 'batch_item' && edge.kind !== 'batch_aggregate') {
            continue;
        }

        const isBatchItem = edge.kind === 'batch_item';
        let sourceId, targetId;

        if (showBatchController) {
            // Controller-centric mode: batch controller is the hub for fan-out/fan-in
            if (isBatchItem) {
                // batch_item: batch_controller ‚Üí stuff_item
                // edge.source is the batch controller, edge.target_stuff_digest is the item
                if (!edge.target_stuff_digest) continue;
                sourceId = edge.source;
                targetId = `stuff_${edge.target_stuff_digest}`;
            } else {
                // batch_aggregate: stuff_item ‚Üí batch_controller
                // edge.source_stuff_digest is the item, edge.target is the batch controller
                if (!edge.source_stuff_digest) continue;
                sourceId = `stuff_${edge.source_stuff_digest}`;
                targetId = edge.target;
            }
        } else {
            // Data-centric mode: edges connect stuff nodes directly
            if (!edge.source_stuff_digest || !edge.target_stuff_digest) continue;
            sourceId = `stuff_${edge.source_stuff_digest}`;
            targetId = `stuff_${edge.target_stuff_digest}`;
        }

        edges.push({
            id: edge.edge_id,
            source: sourceId,
            target: targetId,
            type: "bezier",
            animated: false,
            label: edge.label || '',
            labelStyle: {
                fontSize: '10px',
                fontFamily: "'JetBrains Mono', monospace",
                fill: isBatchItem ? 'var(--color-batch-item)' : 'var(--color-batch-aggregate)',
            },
            labelBgStyle: {
                fill: 'var(--color-bg)',
                fillOpacity: 0.9,
            },
            style: {
                stroke: isBatchItem ? 'var(--color-batch-item)' : 'var(--color-batch-aggregate)',
                strokeWidth: 2,
                strokeDasharray: '5,5',
            },
            markerEnd: {
                type: MarkerType?.ArrowClosed || 'arrowclosed',
                color: isBatchItem ? 'var(--color-batch-item)' : 'var(--color-batch-aggregate)',
            },
        });
    }

    return { nodes, edges };
}

// ====================================================================
// FALLBACK: Build orchestration graph from ViewSpec (no dataflow)
// ====================================================================
function buildOrchestrationGraph(viewspec) {
    const nodes = viewspec.nodes.map(node => {
        const isController = node.kind === 'controller';
        const isFailed = node.ui?.classes?.includes('failed');
        const isSucceeded = node.ui?.classes?.includes('succeeded');
        const badge = node.ui?.badges?.[0] || '';
        // Calculate width: ~8px per char (monospace 13px) + padding + status dot
        const nodeWidth = Math.max(160, (node.label?.length || 10) * 8 + 50);

        return {
            id: node.id,
            type: 'default',
            data: {
                label: React.createElement('div', {
                    style: {
                        padding: '10px 14px',
                        display: 'flex',
                        flexDirection: 'column',
                        gap: '4px',
                    }
                },
                    React.createElement('div', {
                        style: {
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'space-between',
                            gap: '8px',
                        }
                    },
                        React.createElement('span', {
                            style: {
                                fontFamily: "'JetBrains Mono', monospace",
                                fontSize: '13px',
                                fontWeight: 600,
                                color: 'var(--color-pipe-text)',
                            }
                        }, node.label),
                        isSucceeded && React.createElement('span', {
                            style: {
                                width: '8px',
                                height: '8px',
                                borderRadius: '50%',
                                background: 'var(--color-success)',
                                flexShrink: 0,
                            }
                        }),
                        isFailed && React.createElement('span', {
                            style: {
                                width: '8px',
                                height: '8px',
                                borderRadius: '50%',
                                background: 'var(--color-error)',
                                flexShrink: 0,
                            }
                        })
                    ),
                    React.createElement('div', {
                        style: {
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'space-between',
                            gap: '8px',
                        }
                    },
                        React.createElement('span', {
                            style: {
                                fontSize: '11px',
                                color: 'var(--color-text-dim)',
                            }
                        }, isController ? 'Controller' : node.inspector?.pipe_type || 'Operator'),
                        badge && React.createElement('span', {
                            style: {
                                fontSize: '10px',
                                color: 'var(--color-text-muted)',
                                background: 'var(--color-surface-hover)',
                                padding: '2px 6px',
                                borderRadius: '4px',
                                fontFamily: "'JetBrains Mono', monospace",
                            }
                        }, badge)
                    )
                ),
                nodeData: node,
                isPipe: true,
                isStuff: false,
            },
            position: node.position || { x: 0, y: 0 },
            style: {
                background: isFailed ? 'var(--color-pipe-failed-bg)' : 'var(--color-pipe-bg)',
                border: isFailed ? '2px solid var(--color-pipe-failed)' : '2px solid var(--color-pipe)',
                borderRadius: '8px',
                padding: '0',
                width: nodeWidth + 'px',
                boxShadow: 'var(--shadow-md)',
            },
        };
    });

    const edges = viewspec.edges.map(edge => ({
        id: edge.id,
        source: edge.source,
        target: edge.target,
        type: "bezier",
        animated: edge.animated || false,
        label: edge.label,
        labelStyle: {
            fontSize: 11,
            fontWeight: 500,
            fill: 'var(--color-text-muted)',
            fontFamily: "'JetBrains Mono', monospace",
        },
        labelBgStyle: {
            fill: '#0f172a',
            fillOpacity: 0.9,
        },
        labelBgPadding: [6, 4],
        labelBgBorderRadius: 4,
        style: {
            stroke: edge.kind === 'data' ? 'var(--color-edge)' : 'var(--color-text-dim)',
            strokeWidth: edge.kind === 'data' ? 2 : 1,
        },
        markerEnd: {
            type: MarkerType?.ArrowClosed || 'arrowclosed',
            color: edge.kind === 'data' ? 'var(--color-edge)' : 'var(--color-text-dim)',
        },
    }));

    return { nodes, edges };
}

// ====================================================================
// MAIN REACT COMPONENT
// ====================================================================
function GraphViewer() {
    // Build graph based on available data
    let initialData;
    if (hasDataflow) {
        initialData = buildDataflowGraph(graphspec, dataflowAnalysis);
    } else {
        initialData = buildOrchestrationGraph(viewspec);
    }

    // Apply layout
    const needsLayout = initialData.nodes.some(n => !n.position || (n.position.x === 0 && n.position.y === 0));
    const layouted = needsLayout
        ? getLayoutedElements(initialData.nodes, initialData.edges, initialDirection)
        : initialData;

    const [nodes, setNodes, onNodesChange] = useNodesState(layouted.nodes);
    const [edges, setEdges, onEdgesChange] = useEdgesState(layouted.edges);
    const [selectedNodeId, setSelectedNodeId] = React.useState(null);
    const [direction, setDirection] = React.useState(initialDirection);
    const reactFlowRef = React.useRef(null);
    const prevDirectionRef = React.useRef(initialDirection);

    // Expose setLayoutDirection so the header button can trigger re-layout
    React.useEffect(() => {
        window.setLayoutDirection = setDirection;
        return () => { window.setLayoutDirection = null; };
    }, [setDirection]);

    // Re-layout when direction changes, then fit the view
    React.useEffect(() => {
        // Skip the initial mount ‚Äî only re-layout on actual direction changes
        if (prevDirectionRef.current === direction) return;
        prevDirectionRef.current = direction;
        const relayouted = getLayoutedElements(initialData.nodes, initialData.edges, direction);
        setNodes(relayouted.nodes);
        setEdges(relayouted.edges);
        // Wait for React to render the new positions, then fit view
        setTimeout(() => {
            if (reactFlowRef.current) {
                reactFlowRef.current.fitView({ padding: 0.1 });
            }
        }, 50);
    }, [direction]);

    // Expose function to clear node selection globally
    React.useEffect(() => {
        window.clearNodeSelection = () => {
            setSelectedNodeId(null);
            setNodes((nds) =>
                nds.map((n) => ({
                    ...n,
                    selected: false,
                }))
            );
        };
    }, [setNodes]);

    const onNodeClick = (event, node) => {
        // Update selected node state and highlight it
        setSelectedNodeId(node.id);
        setNodes((nds) =>
            nds.map((n) => ({
                ...n,
                selected: n.id === node.id,
            }))
        );
        const inspector = document.getElementById('inspector');
        const inspectorContent = document.getElementById('inspector-content');
        const inspectorTitle = document.getElementById('inspector-title');
        const inspectorSubtitle = document.getElementById('inspector-subtitle');
        const inspectorHeader = document.getElementById('inspector-header');

        // Reset scroll to top-left when switching nodes (keep tab selection)
        inspectorContent.scrollTop = 0;
        inspectorContent.scrollLeft = 0;

        const nodeData = node.data || {};

        // Handle stuff nodes
        if (nodeData.isStuff) {
            const stuffData = nodeData.stuffData || {};
            const stuffDigest = nodeData.stuffDigest;
            const stuffMermaidId = stuffDigest ? `s_${stuffDigest.substring(0, 10)}` : null;

            inspectorTitle.textContent = stuffData.name || 'Data';
            inspectorSubtitle.textContent = stuffData.concept || 'Data Item';
            inspectorHeader.className = 'inspector-header stuff';

            // Check which formats are available
            // First check graphspec-extracted data, then fallback to separate dictionaries
            const hasJson = !!stuffData.data;
            const hasText = !!stuffData.dataText || (stuffMermaidId && !!stuffDataText[stuffMermaidId]);
            // For PDF and image content types, HTML tab can render from JSON data via extractUrl()
            const canRenderFromJson = (stuffData.contentType === 'application/pdf' || stuffData.contentType?.startsWith('image/')) && extractUrl(stuffData.data);
            const hasHtml = !!stuffData.dataHtml || (stuffMermaidId && !!stuffDataHtml[stuffMermaidId]) || canRenderFromJson;
            const hasMultipleFormats = [hasJson, hasText, hasHtml].filter(Boolean).length > 1;

            let html = '';

            // Add format tabs if multiple formats available
            if (hasMultipleFormats) {
                html += '<div class="inspector-section">';
                html += '<div class="format-toolbar">';
                html += '<div class="format-tabs" id="stuff-format-tabs">';
                const jsonActive = currentStuffFormat === 'json' ? 'active' : '';
                const textActive = currentStuffFormat === 'text' ? 'active' : '';
                const htmlActive = currentStuffFormat === 'html' ? 'active' : '';
                const htmlTabLabel = getHtmlTabLabel(stuffData.contentType);
                html += `<button class="format-tab ${htmlActive}" data-format="html" `;
                html += `${!hasHtml ? 'disabled' : ''}>${htmlTabLabel}</button>`;
                html += `<button class="format-tab ${jsonActive}" data-format="json" `;
                html += `${!hasJson ? 'disabled' : ''}>JSON</button>`;
                html += `<button class="format-tab ${textActive}" data-format="text" `;
                html += `${!hasText ? 'disabled' : ''}>Pretty</button>`;
                html += '</div>';
                html += '<div class="format-actions">';
                html += '<button class="action-btn" id="open-external-btn" ';
                html += 'onclick="openExternal()" title="Open in new window" style="display: none;">';
                html += '<svg viewBox="0 0 24 24"><path d="M19 19H5V5h7V3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg>';
                html += '</button>';
                html += '<button class="action-btn" id="fullscreen-open-btn" ';
                html += 'onclick="openFullscreen()" title="Fullscreen">';
                html += '<svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>';
                html += '</button>';
                html += '<button class="action-btn" id="copy-btn" ';
                html += 'onclick="copyStuffContent()" title="Copy">';
                html += '<svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1z';
                html += 'm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2z';
                html += 'm0 16H8V7h11v14z"/></svg></button>';
                html += '<button class="action-btn" id="download-btn" ';
                html += 'onclick="downloadStuffContent()" title="Download">';
                html += '<svg viewBox="0 0 24 24">';
                html += '<path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>';
                html += '</svg></button>';
                html += '</div>';
                html += '</div>';
                html += '<div id="stuff-data-content"></div>';
                html += '</div>';
            } else if (hasJson || hasText || hasHtml) {
                html += '<div class="inspector-section">';
                html += '<div class="format-toolbar">';
                html += '<div class="format-tabs"></div>';
                html += '<div class="format-actions">';
                html += '<button class="action-btn" id="open-external-btn" ';
                html += 'onclick="openExternal()" title="Open in new window" style="display: none;">';
                html += '<svg viewBox="0 0 24 24"><path d="M19 19H5V5h7V3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg>';
                html += '</button>';
                html += '<button class="action-btn" id="fullscreen-open-btn" ';
                html += 'onclick="openFullscreen()" title="Fullscreen">';
                html += '<svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>';
                html += '</button>';
                html += '<button class="action-btn" id="copy-btn" ';
                html += 'onclick="copyStuffContent()" title="Copy">';
                html += '<svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1z';
                html += 'm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2z';
                html += 'm0 16H8V7h11v14z"/></svg></button>';
                html += '<button class="action-btn" id="download-btn" ';
                html += 'onclick="downloadStuffContent()" title="Download">';
                html += '<svg viewBox="0 0 24 24">';
                html += '<path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>';
                html += '</svg></button>';
                html += '</div>';
                html += '</div>';
                html += '<div id="stuff-data-content"></div>';
                html += '</div>';
            }

            inspectorContent.innerHTML = html;
            // Add class to enable flex behavior for stuff inspector
            inspectorContent.classList.add('stuff-inspector');

            // Store current stuff data for format switching
            window.currentStuffJsonData = stuffData.data;
            window.currentStuffMermaidId = stuffMermaidId;
            window.currentStuffContentType = stuffData.contentType;
            // Store graphspec-extracted text/html data (preferred over dictionary lookups)
            window.currentStuffDataText = stuffData.dataText;
            window.currentStuffDataHtml = stuffData.dataHtml;

            // Attach format tab handlers
            const formatTabs = document.getElementById('stuff-format-tabs');
            if (formatTabs) {
                formatTabs.querySelectorAll('.format-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        if (tab.disabled) return;
                        setStuffFormat(tab.dataset.format);
                    });
                });
            }

            // Render initial content
            if (hasJson || hasText || hasHtml) {
                // Determine best available format (HTML -> JSON -> Pretty)
                let bestFormat = currentStuffFormat;
                if (bestFormat === 'html' && !hasHtml) bestFormat = hasJson ? 'json' : 'text';
                if (bestFormat === 'json' && !hasJson) bestFormat = hasHtml ? 'html' : 'text';
                if (bestFormat === 'text' && !hasText) bestFormat = hasHtml ? 'html' : 'json';

                renderStuffContent(bestFormat);
            }

            document.getElementById('top-hint').style.display = 'none';
            inspector.classList.add('visible');
            return;
        }

        // Handle pipe nodes
        const pipeData = nodeData.nodeData || {};
        inspectorTitle.textContent = pipeData.pipe_code || pipeData.label || node.id;
        inspectorSubtitle.textContent = pipeData.pipe_type || nodeData.kind || 'Pipe';
        inspectorHeader.className = 'inspector-header pipe';

        const timing = pipeData.timing;
        const nodeIo = pipeData.node_io;
        const status = pipeData.status;

        let html = '';

        // Status badges
        html += '<div class="inspector-badges">';
        if (status === 'succeeded') {
            html += '<span class="inspector-badge success">‚úì Succeeded</span>';
        } else if (status === 'failed') {
            html += '<span class="inspector-badge error">‚úï Failed</span>';
        }
        html += `<span class="inspector-badge neutral">‚è± ${timing.duration.toFixed(2)}s</span>`;
        html += '</div>';

        // Pipe info
        if (pipeData.pipe_code) {
            html += `<div class="inspector-section">
                <div class="inspector-section-title">Pipe Code</div>
                <div class="inspector-value pipe-code">${pipeData.pipe_code}</div>
            </div>`;
        }

        if (pipeData.pipe_type) {
            html += `<div class="inspector-section">
                <div class="inspector-section-title">Pipe Type</div>
                <div class="inspector-value">${pipeData.pipe_type}</div>
            </div>`;
        }

        if (timing) {
            html += `<div class="inspector-section">
                <div class="inspector-section-title">Timing</div>
                <div class="inspector-row">
                    <span class="inspector-row-label">Started</span>
                    <span class="inspector-row-value">${new Date(timing.started_at).toLocaleTimeString()}</span>
                </div>
                <div class="inspector-row">
                    <span class="inspector-row-label">Ended</span>
                    <span class="inspector-row-value">${new Date(timing.ended_at).toLocaleTimeString()}</span>
                </div>
                <div class="inspector-row">
                    <span class="inspector-row-label">Duration</span>
                    <span class="inspector-row-value">${timing.duration.toFixed(2)}s</span>
                </div>
            </div>`;
        }

        if (nodeIo?.inputs?.length > 0) {
            html += `<div class="inspector-section">
                <div class="inspector-section-title">Inputs (${nodeIo.inputs.length})</div>
                <div class="inspector-pre">${nodeIo.inputs.map(i => `${i.name}: ${i.concept || 'unknown'}`).join('\\n')}</div>
            </div>`;
        }

        if (nodeIo?.outputs?.length > 0) {
            html += `<div class="inspector-section">
                <div class="inspector-section-title">Outputs (${nodeIo.outputs.length})</div>
                <div class="inspector-pre">${nodeIo.outputs.map(o => `${o.name}: ${o.concept || 'unknown'}`).join('\\n')}</div>
            </div>`;
        }

        if (pipeData.error) {
            html += `<div class="inspector-section">
                <div class="inspector-section-title">Error</div>
                <pre class="inspector-pre" style="color: var(--color-error);">${JSON.stringify(pipeData.error, null, 2)}</pre>
            </div>`;
        }

        inspectorContent.innerHTML = html || '<div style="color: var(--color-text-dim)">No additional information</div>';
        // Remove stuff-specific flex behavior for pipe inspector
        inspectorContent.classList.remove('stuff-inspector');
        document.getElementById('top-hint').style.display = 'none';
        inspector.classList.add('visible');
    };

    if (!ReactFlow) {
        return React.createElement('div', { style: { padding: '20px', color: 'var(--color-text)' } },
            React.createElement('p', null, 'Loading ReactFlow...')
        );
    }

    // Store ReactFlow instance for programmatic viewport control
    const onInit = (reactFlowInstance) => {
        reactFlowRef.current = reactFlowInstance;
        // Pan to show the top of the graph after initial fit
        setTimeout(() => {
            const currentNodes = reactFlowInstance.getNodes();
            if (currentNodes.length === 0) return;
            const minY = Math.min(...currentNodes.map(n => n.position.y));
            const viewport = reactFlowInstance.getViewport();
            reactFlowInstance.setViewport({
                x: viewport.x,
                y: -minY * viewport.zoom + 80,
                zoom: viewport.zoom
            });
        }, 100);
    };

    return React.createElement('div', { className: 'react-flow-container' },
        React.createElement(ReactFlow, {
            nodes: nodes,
            edges: edges,
            onNodesChange: onNodesChange,
            onEdgesChange: onEdgesChange,
            onNodeClick: onNodeClick,
            onInit: onInit,
            fitView: true,
            fitViewOptions: { padding: 0.1, minZoom: 1.0 },
            defaultEdgeOptions: { type: "bezier" },
            proOptions: { hideAttribution: true },
        },
            Background ? React.createElement(Background, {
                variant: 'dots',
                gap: 20,
                size: 1,
                color: '#334155',
            }) : null,
            Controls ? React.createElement(Controls, { showInteractive: false }) : null
        )
    );
}

// Render the app
const root = ReactDOM.createRoot(document.getElementById('root'));
const graphViewerRef = { current: null };
root.render(React.createElement(GraphViewer));

// Close inspector function
function closeInspector() {
    document.getElementById('inspector').classList.remove('visible');
    document.getElementById('top-hint').style.display = '';
    // Clear node selection/highlighting when closing inspector
    if (window.clearNodeSelection) {
        window.clearNodeSelection();
    }
}

// Close inspector on Escape key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeInspector();
    }
});

// Inspector resize functionality
(function() {
    const inspector = document.getElementById('inspector');
    const resizeHandle = document.getElementById('inspector-resize-handle');
    let isResizing = false;
    let startX = 0;
    let startWidth = 0;

    resizeHandle.addEventListener('mousedown', (e) => {
        isResizing = true;
        startX = e.clientX;
        startWidth = inspector.offsetWidth;
        resizeHandle.classList.add('dragging');
        document.body.style.cursor = 'ew-resize';
        document.body.style.userSelect = 'none';
        e.preventDefault();
    });

    document.addEventListener('mousemove', (e) => {
        if (!isResizing) return;
        const deltaX = startX - e.clientX;
        const newWidth = Math.max(300, Math.min(startWidth + deltaX, window.innerWidth * 0.8));
        inspector.style.width = newWidth + 'px';
    });

    document.addEventListener('mouseup', () => {
        if (isResizing) {
            isResizing = false;
            resizeHandle.classList.remove('dragging');
            document.body.style.cursor = '';
            document.body.style.userSelect = '';
        }
    });
})();

// Set stuff display format and re-render
function setStuffFormat(format) {
    currentStuffFormat = format;
    // Update tab styling
    document.querySelectorAll('.format-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.format === format);
    });
    renderStuffContent(format);
}

// Render stuff content in the specified format
function renderStuffContent(format) {
    const container = document.getElementById('stuff-data-content');
    if (!container) return;

    const stuffMermaidId = window.currentStuffMermaidId;
    const jsonData = window.currentStuffJsonData;
    const contentType = window.currentStuffContentType;
    // Prefer graphspec-extracted data, fallback to dictionary lookups
    const textData = window.currentStuffDataText || (stuffMermaidId && stuffDataText[stuffMermaidId]);
    const htmlData = window.currentStuffDataHtml || (stuffMermaidId && stuffDataHtml[stuffMermaidId]);

    // Handle PDF content type with embedded viewer
    if (format === 'html' && contentType === 'application/pdf') {
        const pdfUrl = extractUrl(jsonData);
        if (pdfUrl) {
            container.className = 'inspector-pdf-content';
            container.innerHTML = '';
            const embed = document.createElement('embed');
            embed.src = pdfUrl;
            embed.type = 'application/pdf';
            embed.style.cssText = 'width:100%; height:100%; border:none;';
            container.appendChild(embed);
            updateOpenExternalButton();
            return;
        }
    }

    // Handle image content type
    if (format === 'html' && contentType?.startsWith('image/')) {
        const imageUrl = extractUrl(jsonData);
        if (imageUrl) {
            container.className = 'inspector-image-content';
            container.innerHTML = '';
            const img = document.createElement('img');
            img.src = imageUrl;
            img.style.cssText = 'max-width:100%; max-height:100%; object-fit:contain;';
            img.alt = 'Image content';
            container.appendChild(img);
            updateOpenExternalButton();
            return;
        }
    }

    if (format === 'json') {
        container.className = '';
        const jsonStr = JSON.stringify(jsonData, null, 2);
        container.innerHTML = `<pre class="inspector-pre">${escapeHtml(jsonStr)}</pre>`;
    } else if (format === 'text') {
        // Use nowrap class for Rich-formatted ASCII tables
        const textContent = textData || 'No text data available';
        container.className = '';
        container.innerHTML = `<pre class="inspector-pre nowrap">${escapeHtml(textContent)}</pre>`;
    } else if (format === 'html') {
        const htmlContent = htmlData || 'No HTML data available';
        container.className = 'inspector-html-content';
        container.innerHTML = DOMPurify.sanitize(htmlContent);
        makeLinksOpenInNewWindow(container);
    }

    updateOpenExternalButton();
}

// Get current stuff content based on active format
function getCurrentStuffContent() {
    const stuffMermaidId = window.currentStuffMermaidId;
    const jsonData = window.currentStuffJsonData;
    const textData = window.currentStuffDataText || (stuffMermaidId && stuffDataText[stuffMermaidId]);
    const htmlData = window.currentStuffDataHtml || (stuffMermaidId && stuffDataHtml[stuffMermaidId]);

    if (currentStuffFormat === 'json' && jsonData) {
        return { content: JSON.stringify(jsonData, null, 2), ext: 'json', mime: 'application/json' };
    } else if (currentStuffFormat === 'text' && textData) {
        return { content: textData, ext: 'txt', mime: 'text/plain' };
    } else if (currentStuffFormat === 'html' && htmlData) {
        return { content: htmlData, ext: 'html', mime: 'text/html' };
    }
    return null;
}

// Copy stuff content to clipboard
function copyStuffContent() {
    const data = getCurrentStuffContent();
    if (!data) return;

    navigator.clipboard.writeText(data.content).then(() => {
        // Update both inspector and fullscreen buttons if they exist
        const btn = document.getElementById('copy-btn');
        const fullscreenBtn = document.getElementById('fullscreen-copy-btn');
        const checkIcon = '<svg viewBox="0 0 24 24">' +
            '<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>';
        const copyIcon = '<svg viewBox="0 0 24 24">' +
            '<path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1z' +
            'm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2z' +
            'm0 16H8V7h11v14z"/></svg>';
        
        if (btn) {
            btn.innerHTML = checkIcon;
            btn.classList.add('copied');
            setTimeout(() => {
                btn.innerHTML = copyIcon;
                btn.classList.remove('copied');
            }, 1500);
        }
        
        if (fullscreenBtn) {
            fullscreenBtn.innerHTML = checkIcon;
            fullscreenBtn.classList.add('copied');
            setTimeout(() => {
                fullscreenBtn.innerHTML = copyIcon;
                fullscreenBtn.classList.remove('copied');
            }, 1500);
        }
    });
}

// Download stuff content as file
function downloadStuffContent() {
    const stuffName = document.getElementById('inspector-title')?.textContent || 'data';
    const baseName = stuffName.replace(/[^a-zA-Z0-9_-]/g, '_');
    const contentType = window.currentStuffContentType;
    const jsonData = window.currentStuffJsonData;

    // For images, download the actual image file directly
    if (contentType?.startsWith('image/')) {
        const imageUrl = extractUrl(jsonData);
        if (imageUrl) {
            const ext = contentType.split('/')[1] || 'png';
            const filename = `${baseName}.${ext}`;
            const link = document.createElement('a');
            link.href = imageUrl;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            return;
        }
    }

    // For PDFs, download the actual PDF file directly
    if (contentType === 'application/pdf') {
        const pdfUrl = extractUrl(jsonData);
        if (pdfUrl) {
            const filename = `${baseName}.pdf`;
            const link = document.createElement('a');
            link.href = pdfUrl;
            link.download = filename;
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            return;
        }
    }

    const data = getCurrentStuffContent();
    if (!data) return;

    const filename = `${baseName}.${data.ext}`;
    const blob = new Blob([data.content], { type: data.mime });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = filename;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
}

// Include shared utility functions
// ============================================================
// Shared Stuff Display Utilities
// Used by both mermaidflow and reactflow implementations
// ============================================================

// XSS-safe HTML escaping
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Make all links in a container open in new windows
function makeLinksOpenInNewWindow(container) {
    if (!container) return;
    const links = container.querySelectorAll('a');
    links.forEach(link => {
        link.setAttribute('target', '_blank');
        link.setAttribute('rel', 'noopener noreferrer');
    });
}

// Validate that a URL is safe for display (prevents javascript: and data: URL injection)
function isSafeDisplayUrl(url) {
    if (!url || typeof url !== 'string') return false;
    return url.startsWith('https://') || url.startsWith('http://') || url.startsWith('file://');
}

// Extract URL from stuff data (handles various data structures)
// Returns null for invalid/unsafe URLs (javascript:, data:, etc.)
function extractUrl(jsonData) {
    if (!jsonData) return null;
    // Check if data itself is a URL string
    if (typeof jsonData === 'string') {
        return isSafeDisplayUrl(jsonData) ? jsonData : null;
    }
    // Prefer public_url (pre-signed S3 URL or file:// URI) over url (internal pipelex-storage:// URL)
    const candidates = [jsonData.public_url, jsonData.src, jsonData.href, jsonData.uri, jsonData.url];
    for (const candidate of candidates) {
        if (isSafeDisplayUrl(candidate)) return candidate;
    }
    return null;
}

// Get appropriate tab label based on content type
function getHtmlTabLabel(contentType) {
    if (contentType === 'application/pdf') return 'PDF';
    if (contentType?.startsWith('image/')) return 'Image';
    return 'HTML';
}
// Open external URL for PDF content
function openExternal() {
    const contentType = window.currentStuffContentType;
    const jsonData = window.currentStuffJsonData;

    if (contentType === 'application/pdf') {
        const url = extractUrl(jsonData);
        if (url) {
            window.open(url, '_blank', 'noopener,noreferrer');
        }
    }
}

// Update visibility of the "open in new window" button (PDF only)
function updateOpenExternalButton() {
    const openExternalBtn = document.getElementById('open-external-btn');
    const fullscreenOpenExternalBtn = document.getElementById('fullscreen-open-external-btn');

    const contentType = window.currentStuffContentType;
    const jsonData = window.currentStuffJsonData;
    const url = extractUrl(jsonData);
    // Only show for PDFs (images are handled by the download button)
    const shouldShow = contentType === 'application/pdf' && !!url;

    if (openExternalBtn) {
        openExternalBtn.style.display = shouldShow ? '' : 'none';
    }
    if (fullscreenOpenExternalBtn) {
        fullscreenOpenExternalBtn.style.display = shouldShow ? '' : 'none';
    }
}

// Open fullscreen view
function openFullscreen() {
    const modal = document.getElementById('fullscreen-modal');
    const fullscreenTitle = document.getElementById('fullscreen-title');
    const fullscreenSubtitle = document.getElementById('fullscreen-subtitle');
    const fullscreenContent = document.getElementById('fullscreen-content');
    const fullscreenFormatTabs = document.getElementById('fullscreen-format-tabs');
    
    // Copy title and subtitle from inspector
    const inspectorTitle = document.getElementById('inspector-title');
    const inspectorSubtitle = document.getElementById('inspector-subtitle');
    fullscreenTitle.textContent = inspectorTitle.textContent;
    fullscreenSubtitle.textContent = inspectorSubtitle.textContent;
    
    // Build format tabs if multiple formats available
    const stuffMermaidId = window.currentStuffMermaidId;
    const jsonData = window.currentStuffJsonData;
    const textData = window.currentStuffDataText || (stuffMermaidId && stuffDataText[stuffMermaidId]);
    const htmlData = window.currentStuffDataHtml || (stuffMermaidId && stuffDataHtml[stuffMermaidId]);
    const hasJson = !!jsonData;
    const hasText = !!textData;
    // For PDF and image content types, HTML tab can render from JSON data via extractUrl()
    const contentType = window.currentStuffContentType;
    const canRenderFromJson = (contentType === 'application/pdf' || contentType?.startsWith('image/')) && extractUrl(jsonData);
    const hasHtml = !!htmlData || canRenderFromJson;
    const hasMultipleFormats = [hasJson, hasText, hasHtml].filter(Boolean).length > 1;
    
    if (hasMultipleFormats) {
        const jsonActive = currentStuffFormat === 'json' ? 'active' : '';
        const textActive = currentStuffFormat === 'text' ? 'active' : '';
        const htmlActive = currentStuffFormat === 'html' ? 'active' : '';
        const htmlTabLabel = getHtmlTabLabel(window.currentStuffContentType);
        let tabsHtml = '';
        tabsHtml += `<button class="format-tab ${htmlActive}" data-format="html" `;
        tabsHtml += `${!hasHtml ? 'disabled' : ''}>${htmlTabLabel}</button>`;
        tabsHtml += `<button class="format-tab ${jsonActive}" data-format="json" `;
        tabsHtml += `${!hasJson ? 'disabled' : ''}>JSON</button>`;
        tabsHtml += `<button class="format-tab ${textActive}" data-format="text" `;
        tabsHtml += `${!hasText ? 'disabled' : ''}>Pretty</button>`;
        fullscreenFormatTabs.innerHTML = tabsHtml;
        
        // Attach format tab handlers
        fullscreenFormatTabs.querySelectorAll('.format-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                if (tab.disabled) return;
                setStuffFormat(tab.dataset.format, true);
            });
        });
    } else {
        fullscreenFormatTabs.innerHTML = '';
    }
    
    // Render initial content
    renderStuffContentFullscreen(currentStuffFormat);
    
    // Show modal
    modal.classList.add('visible');
    
    // Disable body scroll
    document.body.style.overflow = 'hidden';
}

// Close fullscreen view (back to sidebar inspector)
function closeFullscreen() {
    const modal = document.getElementById('fullscreen-modal');
    modal.classList.remove('visible');

    // Re-enable body scroll
    document.body.style.overflow = '';
}

// Minimize fullscreen (alias for closeFullscreen - returns to sidebar)
function minimizeFullscreen() {
    closeFullscreen();
}

// Close both fullscreen and inspector panel
function closeFullscreenAndInspector() {
    closeFullscreen();
    closeInspector();
}

// Close fullscreen on Escape key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        const modal = document.getElementById('fullscreen-modal');
        if (modal.classList.contains('visible')) {
            closeFullscreen();
        }
    }
});

// Update setStuffFormat to handle both inspector and fullscreen
const originalSetStuffFormat = setStuffFormat;
function setStuffFormat(format, updateFullscreen = false) {
    currentStuffFormat = format;
    
    // Update inspector tabs
    const inspectorTabs = document.getElementById('stuff-format-tabs');
    if (inspectorTabs) {
        inspectorTabs.querySelectorAll('.format-tab').forEach(tab => {
            tab.classList.toggle('active', tab.dataset.format === format);
        });
        renderStuffContent(format);
    }
    
    // Update fullscreen tabs if it's open
    const modal = document.getElementById('fullscreen-modal');
    if (modal.classList.contains('visible') || updateFullscreen) {
        const fullscreenTabs = document.getElementById('fullscreen-format-tabs');
        if (fullscreenTabs) {
            fullscreenTabs.querySelectorAll('.format-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.format === format);
            });
        }
        renderStuffContentFullscreen(format);
    }
}

// Render stuff content in fullscreen view
function renderStuffContentFullscreen(format) {
    const container = document.getElementById('fullscreen-content');
    if (!container) return;

    const stuffMermaidId = window.currentStuffMermaidId;
    const jsonData = window.currentStuffJsonData;
    const contentType = window.currentStuffContentType;
    const textData = window.currentStuffDataText || (stuffMermaidId && stuffDataText[stuffMermaidId]);
    const htmlData = window.currentStuffDataHtml || (stuffMermaidId && stuffDataHtml[stuffMermaidId]);

    // Handle PDF content type with embedded viewer
    if (format === 'html' && contentType === 'application/pdf') {
        const pdfUrl = extractUrl(jsonData);
        if (pdfUrl) {
            container.className = 'fullscreen-content inspector-pdf-content';
            container.innerHTML = '';
            const embed = document.createElement('embed');
            embed.src = pdfUrl;
            embed.type = 'application/pdf';
            embed.style.cssText = 'width:100%; height:100%; border:none;';
            container.appendChild(embed);
            updateOpenExternalButton();
            return;
        }
    }

    // Handle image content type
    if (format === 'html' && contentType?.startsWith('image/')) {
        const imageUrl = extractUrl(jsonData);
        if (imageUrl) {
            container.className = 'fullscreen-content inspector-image-content';
            container.innerHTML = '';
            const img = document.createElement('img');
            img.src = imageUrl;
            img.style.cssText = 'max-width:100%; max-height:100%; object-fit:contain;';
            img.alt = 'Image content';
            container.appendChild(img);
            updateOpenExternalButton();
            return;
        }
    }

    if (format === 'json') {
        container.className = 'fullscreen-content';
        const jsonStr = JSON.stringify(jsonData, null, 2);
        container.innerHTML = `<pre class="inspector-pre">${escapeHtml(jsonStr)}</pre>`;
    } else if (format === 'text') {
        const textContent = textData || 'No text data available';
        container.className = 'fullscreen-content';
        container.innerHTML = `<pre class="inspector-pre nowrap">${escapeHtml(textContent)}</pre>`;
    } else if (format === 'html') {
        const htmlContent = htmlData || 'No HTML data available';
        container.className = 'fullscreen-content inspector-html-content';
        container.innerHTML = DOMPurify.sanitize(htmlContent);
        makeLinksOpenInNewWindow(container);
    }

    updateOpenExternalButton();
}    </script>
</body>
</html>